<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªç©ºå¸å›½ - å¾æœå¤ªé˜³ç³»</title>
    <style>
        :root {
            --font-ui:    'Courier New', Consolas, 'SF Mono', monospace;
            --font-body:  -apple-system, 'PingFang SC', 'Microsoft YaHei', 'Hiragino Sans GB', sans-serif;
            --font-mono:  'Courier New', Consolas, monospace;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e1a;
            --bg-panel: rgba(15, 23, 42, 0.92);
            --accent-cyan: #00d9ff;
            --accent-purple: #a855f7;
            --accent-gold: #fbbf24;
            --accent-green: #10b981;
            --text-white: #ffffff;
            --text-gray: #94a3b8;
        }

        body {
            font-family: var(--font-body);
            background: #000;
            color: var(--text-white);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* å®‡å®™ç”»å¸ƒ */
        .universe-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #0a0e1a 0%, #000 100%);
        }

        #universeCanvas {
            width: 100%;
            height: 100%;
        }

        /* UIå±‚ */
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-overlay > * {
            pointer-events: auto;
        }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 1.5rem 2rem;
            background: linear-gradient(to bottom, rgba(10, 14, 26, 0.95), transparent);
            backdrop-filter: blur(10px);
        }

        .game-title {
            text-align: center;
            font-family: var(--font-ui);
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 40px rgba(0, 217, 255, 0.4);
        }

        .civilization-level {
            text-align: center;
            font-family: var(--font-ui);
            font-size: 1.1rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
        }

        .resources-compact {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .resource-compact {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid rgba(0, 217, 255, 0.3);
        }

        .resource-icon-small {
            font-size: 1.5rem;
        }

        .resource-value-small {
            font-family: var(--font-mono);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .resource-rate-small {
            font-size: 0.8rem;
            color: var(--accent-green);
        }

        /* åº•éƒ¨æ§åˆ¶é¢æ¿ */
        .bottom-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(10, 14, 26, 0.95), transparent);
            backdrop-filter: blur(15px);
            padding: 1.5rem 2rem;
            max-height: 40vh;
            overflow-y: auto;
        }

        .panel-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab-button {
            font-family: var(--font-ui);
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .tab-button.active {
            background: rgba(0, 217, 255, 0.2);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .upgrades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .upgrade-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade-card:hover:not(.disabled) {
            background: rgba(0, 217, 255, 0.1);
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
        }

        .upgrade-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .upgrade-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .upgrade-name {
            font-weight: 700;
            font-size: 1rem;
        }

        .upgrade-level-badge {
            background: var(--accent-purple);
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .upgrade-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .upgrade-cost-label {
            color: var(--accent-gold);
            font-family: var(--font-mono);
            font-weight: 700;
        }

        .upgrade-prod-label {
            color: var(--accent-green);
        }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-panel);
            padding: 1.5rem 2rem;
            border-radius: 15px;
            border: 2px solid var(--accent-gold);
            text-align: center;
            min-width: 350px;
            pointer-events: none;
        }

        .progress-title-main {
            font-family: var(--font-ui);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 0.8rem;
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.5rem;
        }

        .progress-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple), var(--accent-gold));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.6);
        }

        .progress-percentage-text {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        /* æç¤ºæ–‡æœ¬ */
        .hint-text {
            position: absolute;
            bottom: 45%;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-gray);
            font-size: 1rem;
            text-align: center;
            pointer-events: none;
            opacity: 0.8;
            animation: hintPulse 2s ease-in-out infinite;
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* é‡Œç¨‹ç¢‘å¼¹çª— */
        .milestone-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }

        .milestone-box {
            background: var(--bg-panel);
            border: 3px solid var(--accent-gold);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            max-width: 600px;
            animation: milestoneZoom 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 80px rgba(251, 191, 36, 0.6);
        }

        @keyframes milestoneZoom {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .milestone-emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: emojiFloat 0.6s ease infinite;
        }

        @keyframes emojiFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .milestone-heading {
            font-family: var(--font-ui);
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .milestone-description {
            font-size: 1.2rem;
            color: var(--text-gray);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .milestone-cta {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            padding: 1rem 3rem;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            font-family: var(--font-ui);
            transition: all 0.3s ease;
        }

        .milestone-cta:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.6);
        }

        /* æµ®åŠ¨æ•°å­— */
        .floating-number {
            position: fixed;
            font-family: var(--font-mono);
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-gold);
            pointer-events: none;
            animation: floatUpAnim 1.5s ease-out forwards;
            text-shadow: 0 0 10px var(--accent-gold);
            z-index: 500;
        }

        @keyframes floatUpAnim {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        /* ç¦»çº¿æ”¶ç›Š */
        .offline-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            animation: fadeIn 0.5s ease;
        }

        .offline-box {
            background: var(--bg-panel);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 60px rgba(0, 217, 255, 0.4);
            max-width: 500px;
        }

        .offline-title {
            font-family: var(--font-ui);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-cyan);
        }

        .offline-amount {
            font-family: var(--font-mono);
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent-gold);
            margin: 1.5rem 0;
            text-shadow: 0 0 30px var(--accent-gold);
        }

        .offline-btn {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            padding: 1rem 3rem;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: var(--font-ui);
        }

        .offline-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.4);
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .game-title {
                font-size: 1.8rem;
            }

            .bottom-panel {
                max-height: 50vh;
            }

            .upgrades-grid {
                grid-template-columns: 1fr;
            }

            .progress-indicator {
                min-width: 280px;
                padding: 1rem 1.5rem;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== CSSè¡Œæ˜Ÿå±‚ï¼ˆå åœ¨canvasä¸Šæ–¹ï¼Œé¿å¼€è·¨åŸŸé™åˆ¶ï¼‰===== */
        #planetLayer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;   /* é»˜è®¤ä¸æ‹¦æˆªï¼Œè¡Œæ˜Ÿè‡ªå·±å¼€å¯ */
            z-index: 10;
        }

        .planet-div {
            position: absolute;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            transform: translate(-50%, -50%);
            cursor: pointer;
            pointer-events: auto;
            transition: filter 0.4s ease, opacity 0.6s ease, box-shadow 0.4s ease;
            box-shadow: 0 0 20px rgba(255,255,255,0.15);
        }

        .planet-div:hover { filter: brightness(1.25); transform: translate(-50%,-50%) scale(1.08); }
        .planet-div:active { transform: translate(-50%,-50%) scale(0.94); }

        .planet-div.locked {
            filter: grayscale(1) brightness(0.3);
            pointer-events: none;
            opacity: 0;             /* æœªè§£é”å®Œå…¨éšè— */
        }

        /* å„æ˜ŸçƒçœŸå®å›¾ç‰‡ï¼ˆå…¬å¼€CDNï¼ŒåŒåŸŸä»£ç†ï¼‰ */
        .p-sun     { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/The_Sun_by_the_Atmospheric_Imaging_Assembly_of_NASA%27s_Solar_Dynamics_Observatory_-_20100819.jpg/480px-The_Sun_by_the_Atmospheric_Imaging_Assembly_of_NASA%27s_Solar_Dynamics_Observatory_-_20100819.jpg');
                     box-shadow: 0 0 80px rgba(253,200,50,0.9), 0 0 160px rgba(253,150,30,0.4); pointer-events:none; }
        .p-mercury { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Mercury_in_true_color.jpg/240px-Mercury_in_true_color.jpg'); }
        .p-venus   { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Venus-real_color.jpg/240px-Venus-real_color.jpg'); }
        .p-earth   { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/240px-The_Earth_seen_from_Apollo_17.jpg');
                     box-shadow: 0 0 35px rgba(74,144,226,0.7); }
        .p-moon    { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/FullMoon2010.jpg/240px-FullMoon2010.jpg'); }
        .p-mars    { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/OSIRIS_Mars_true_color.jpg/240px-OSIRIS_Mars_true_color.jpg');
                     box-shadow: 0 0 30px rgba(217,74,46,0.6); }
        .p-jupiter { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Jupiter_and_its_shrunken_Great_Red_Spot.jpg/240px-Jupiter_and_its_shrunken_Great_Red_Spot.jpg');
                     box-shadow: 0 0 40px rgba(200,139,58,0.5); }
        .p-saturn  { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Saturn_during_Equinox.jpg/320px-Saturn_during_Equinox.jpg');
                     box-shadow: 0 0 40px rgba(250,213,165,0.5); }
        .p-uranus  { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Uranus2.jpg/240px-Uranus2.jpg');
                     box-shadow: 0 0 30px rgba(79,213,214,0.5); }
        .p-neptune { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg/240px-Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg');
                     box-shadow: 0 0 30px rgba(65,102,245,0.5); }

        /* åœŸæ˜Ÿå…‰ç¯ï¼ˆä¼ªå…ƒç´ ï¼Œçº¯CSSï¼‰ */
        .p-saturn::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 185%; height: 50%;
            border: 4px solid rgba(210,180,140,0.55);
            border-radius: 50%;
            transform: translate(-50%,-50%) rotateX(65deg);
            pointer-events: none;
        }

        /* è¡Œæ˜Ÿè‡ªè½¬åŠ¨ç”» */
        @keyframes spinSlow  { from{background-position:0% center} to{background-position:200% center} }
        .p-earth   { animation: spinSlow 60s linear infinite; }
        .p-venus   { animation: spinSlow 90s linear infinite; }
        .p-mars    { animation: spinSlow 55s linear infinite; }
        .p-jupiter { animation: spinSlow 30s linear infinite; }

        /* è§£é”æ—¶çš„å‡ºç°åŠ¨ç”» */
        @keyframes planetAppear {
            0%   { transform: translate(-50%,-50%) scale(0); opacity:0; }
            60%  { transform: translate(-50%,-50%) scale(1.15); }
            100% { transform: translate(-50%,-50%) scale(1);  opacity:1; }
        }
        .planet-div.appearing { animation: planetAppear 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards; }

        /* ===== é€‰å›½å®¶å¼€åœºç•Œé¢ ===== */
        .country-screen {
            position: fixed;
            inset: 0;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 1s ease;
        }

        .country-screen-title {
            font-family: var(--font-ui);
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .country-screen-subtitle {
            color: var(--text-gray);
            font-size: 1rem;
            margin-bottom: 2rem;
            text-align: center;
            font-style: italic;
            max-width: 500px;
            line-height: 1.6;
        }

        .country-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 900px;
        }

        .country-card {
            background: rgba(15, 23, 42, 0.85);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 14px;
            padding: 1.4rem 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .country-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(0,217,255,0.05));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .country-card:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0,217,255,0.25);
        }

        .country-card:hover::before { opacity: 1; }

        .country-card.vip {
            border-color: rgba(251,191,36,0.4);
        }

        .country-card.vip:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 10px 30px rgba(251,191,36,0.3);
        }

        .country-flag {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .country-name {
            font-family: var(--font-ui);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--text-white);
        }

        .country-stats {
            font-size: 0.82rem;
            color: var(--text-gray);
            line-height: 1.7;
        }

        .country-stats span {
            display: block;
        }

        .country-stats .highlight {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        .country-tag {
            display: inline-block;
            margin-top: 0.6rem;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.72rem;
            font-weight: 700;
        }

        .tag-vip { background: rgba(251,191,36,0.2); color: var(--accent-gold); border: 1px solid rgba(251,191,36,0.4); }
        .tag-event { background: rgba(168,85,247,0.2); color: var(--accent-purple); border: 1px solid rgba(168,85,247,0.4); }
        .tag-balanced { background: rgba(16,185,129,0.2); color: var(--accent-green); border: 1px solid rgba(16,185,129,0.4); }
    </style>
</head>
<body>
    <!-- å®‡å®™ç”»å¸ƒï¼ˆåªç»˜åˆ¶æ˜Ÿç©ºã€è½¨é“çº¿ã€å…‰è·¯ã€ç²’å­ï¼‰ -->
    <div class="universe-canvas">
        <canvas id="universeCanvas"></canvas>
    </div>

    <!-- CSSè¡Œæ˜Ÿå±‚ï¼ˆçœŸå®å›¾ç‰‡ï¼Œé¿å¼€Canvasè·¨åŸŸé™åˆ¶ï¼‰ -->
    <div id="planetLayer"></div>

    <!-- é€‰å›½å®¶å¼€åœºç•Œé¢ -->
    <div class="country-screen" id="countryScreen">
        <div class="country-screen-title">ğŸŒŒ å¤ªç©ºå¸å›½</div>
        <div class="country-screen-subtitle">
            "æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä»å¤ªç©ºä¿¯è§†è‡ªå·±çš„å®¶å›­ï¼ŒåŸå¸‚çš„ç¯å…‰åƒä¸€å±‚è–„è–„çš„éœœï¼Œ<br>æ–‡æ˜åœ¨é»‘æš—çš„èƒŒæ™¯ä¸Šæ˜¾å¾—æ ¼å¤–è„†å¼±ã€‚"
        </div>
        <div class="country-grid">
            <div class="country-card vip" onclick="selectCountry('usa')">
                <span class="country-flag">ğŸ‡ºğŸ‡¸</span>
                <div class="country-name">ç¾å›½</div>
                <div class="country-stats">
                    <span>âš¡ åˆå§‹èƒ½é‡ <b class="highlight">1000</b></span>
                    <span>ğŸ¤– æœºå™¨äºº <b class="highlight">100ä¸‡</b></span>
                    <span>ğŸ’° æ˜Ÿå¸åŠ æˆ <b class="highlight">Ã—2</b></span>
                    <span class="country-tag tag-vip">â˜… VIP ä¼˜åŠ¿</span>
                </div>
            </div>
            <div class="country-card" onclick="selectCountry('china')">
                <span class="country-flag">ğŸ‡¨ğŸ‡³</span>
                <div class="country-name">ä¸­å›½</div>
                <div class="country-stats">
                    <span>âš¡ åˆå§‹èƒ½é‡ <b class="highlight">300</b></span>
                    <span>ğŸ¤– æœºå™¨äºº <b class="highlight">15ä¸‡</b></span>
                    <span>ğŸ”¬ ç§‘ç ”åŠ æˆ <b class="highlight">Ã—1.5</b></span>
                    <span class="country-tag tag-event">ç‹¬æœ‰äº‹ä»¶é“¾</span>
                </div>
            </div>
            <div class="country-card" onclick="selectCountry('russia')">
                <span class="country-flag">ğŸ‡·ğŸ‡º</span>
                <div class="country-name">ä¿„ç½—æ–¯</div>
                <div class="country-stats">
                    <span>âš¡ åˆå§‹èƒ½é‡ <b class="highlight">400</b></span>
                    <span>ğŸ¤– æœºå™¨äºº <b class="highlight">20ä¸‡</b></span>
                    <span>ğŸš€ ç«ç®­æˆæœ¬ <b class="highlight">-20%</b></span>
                    <span class="country-tag tag-balanced">å‡è¡¡å‘å±•</span>
                </div>
            </div>
            <div class="country-card" onclick="selectCountry('germany')">
                <span class="country-flag">ğŸ‡©ğŸ‡ª</span>
                <div class="country-name">å¾·å›½</div>
                <div class="country-stats">
                    <span>âš¡ åˆå§‹èƒ½é‡ <b class="highlight">200</b></span>
                    <span>ğŸ¤– æœºå™¨äºº <b class="highlight">8ä¸‡</b></span>
                    <span>âš™ï¸ å‡çº§æˆæœ¬ <b class="highlight">-15%</b></span>
                    <span class="country-tag tag-balanced">å·¥ä¸šå¼ºå›½</span>
                </div>
            </div>
            <div class="country-card" onclick="selectCountry('india')">
                <span class="country-flag">ğŸ‡®ğŸ‡³</span>
                <div class="country-name">å°åº¦</div>
                <div class="country-stats">
                    <span>âš¡ åˆå§‹èƒ½é‡ <b class="highlight">150</b></span>
                    <span>ğŸ¤– æœºå™¨äºº <b class="highlight">6ä¸‡</b></span>
                    <span>ğŸ“ˆ ç‚¹å‡»å€ç‡ <b class="highlight">Ã—2</b></span>
                    <span class="country-tag tag-event">ç‹¬æœ‰äº‹ä»¶é“¾</span>
                </div>
            </div>
        </div>
    </div>

    <!-- UIå±‚ -->
    <div class="ui-overlay">
        <!-- é¡¶éƒ¨æ  -->
        <div class="top-bar">
            <div class="game-title">ğŸŒŒ å¤ªç©ºå¸å›½</div>
            <div class="civilization-level" id="civLevel">ğŸŒ è¡Œæ˜Ÿæ–‡æ˜</div>
            <div class="resources-compact">
                <div class="resource-compact">
                    <span class="resource-icon-small">âš¡</span>
                    <div>
                        <div class="resource-value-small" id="energyVal">0</div>
                        <div class="resource-rate-small" id="energyRate">+0/ç§’</div>
                    </div>
                </div>
                <div class="resource-compact">
                    <span class="resource-icon-small">ğŸª™</span>
                    <div>
                        <div class="resource-value-small" id="creditsVal">0</div>
                        <div class="resource-rate-small" id="creditsRate">+0/ç§’</div>
                    </div>
                </div>
                <div class="resource-compact">
                    <span class="resource-icon-small">ğŸ”¬</span>
                    <div>
                        <div class="resource-value-small" id="scienceVal">0</div>
                        <div class="resource-rate-small" id="scienceRate">+0/ç§’</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ï¼šå›ºå®šåœ¨åº•éƒ¨é¢æ¿æ­£ä¸Šæ–¹ -->
        <div style="position:absolute;bottom:268px;left:50%;transform:translateX(-50%);background:rgba(15,23,42,0.75);padding:0.5rem 1.2rem;border-radius:20px;border:1px solid rgba(251,191,36,0.35);min-width:300px;max-width:500px;width:50%;backdrop-filter:blur(8px);pointer-events:none;">
            <div style="display:flex;align-items:center;gap:0.8rem;">
                <div id="progressTitle" style="font-family:var(--font-ui);font-size:0.75rem;font-weight:700;color:var(--accent-gold);white-space:nowrap;flex-shrink:0;">ğŸ¯ è·ç¦»åœ°æœˆç³»ç»Ÿ</div>
                <div style="flex:1;height:10px;background:rgba(0,0,0,0.5);border-radius:5px;overflow:hidden;">
                    <div id="progressBar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-purple),var(--accent-gold));border-radius:5px;transition:width 0.5s ease;box-shadow:0 0 8px rgba(0,217,255,0.5);"></div>
                </div>
                <div id="progressPercent" style="font-family:var(--font-mono);font-size:0.75rem;color:var(--text-gray);white-space:nowrap;flex-shrink:0;">0%</div>
            </div>
        </div>

        <!-- æç¤ºæ–‡æœ¬å·²ç§»é™¤ï¼Œç”±ç‚¹å‡»åé¦ˆä»£æ›¿ -->

        <!-- åº•éƒ¨é¢æ¿ -->
        <div class="bottom-panel">
            <div class="panel-tabs">
                <button class="tab-button active" data-tab="mining">â›ï¸ é‡‡çŸ¿</button>
                <button class="tab-button" data-tab="factory">ğŸ­ å·¥å‚</button>
                <button class="tab-button" data-tab="science">ğŸ”¬ ç§‘ç ”</button>
                <button class="tab-button" data-tab="special">âœ¨ ç‰¹æ®Š</button>
            </div>

            <div class="tab-content active" id="tab-mining">
                <div class="upgrades-grid" id="miningGrid"></div>
            </div>
            <div class="tab-content" id="tab-factory">
                <div class="upgrades-grid" id="factoryGrid"></div>
            </div>
            <div class="tab-content" id="tab-science">
                <div class="upgrades-grid" id="scienceGrid"></div>
            </div>
            <div class="tab-content" id="tab-special">
                <div class="upgrades-grid" id="specialGrid"></div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const game = {
            energy: 0,
            credits: 0,
            science: 0,
            clickPower: 3,
            energyPerSec: 0,
            creditsPerSec: 0,
            sciencePerSec: 0,
            totalEarned: 0,
            totalClicks: 0,
            currentStage: 0,
            lastSaveTime: Date.now(),
            unlockedPlanets: ['earth'],
            upgrades: { mining: [], factory: [], science: [], special: [] }
        };

        // æ–‡æ˜é˜¶æ®µ
        const stages = [
            { id: 0, name: 'ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', desc: 'äººç±»æ–‡æ˜çš„èµ·ç‚¹', threshold: 0, nextThreshold: 200, view: 'earth' },
            { id: 1, name: 'ğŸŒ™ åœ°æœˆç³»ç»Ÿ', desc: 'æœˆçƒæˆä¸ºäººç±»ç¬¬äºŒå®¶å›­', threshold: 200, nextThreshold: 1000, view: 'inner' },
            { id: 2, name: 'ğŸª å†…è¡Œæ˜Ÿå¾æœ', desc: 'æ°´æ˜Ÿã€é‡‘æ˜Ÿã€ç«æ˜Ÿæ®–æ°‘å®Œæˆ', threshold: 1000, nextThreshold: 5000, view: 'inner' },
            { id: 3, name: 'â˜€ï¸ å¤ªé˜³ç³»éœ¸ä¸»', desc: 'æŒæ§å…«å¤§è¡Œæ˜Ÿ', threshold: 5000, nextThreshold: 25000, view: 'solar' },
            { id: 4, name: 'ğŸŒŒ é“¶æ²³æ¢ç´¢è€…', desc: 'æ˜Ÿé™…æ—¶ä»£æ¥ä¸´', threshold: 25000, nextThreshold: Infinity, view: 'galaxy' }
        ];

        // è¡Œæ˜Ÿæ•°æ®
        // è¡Œæ˜Ÿæ•°æ®ï¼ˆè·ç¦»/è§’åº¦å†³å®šå¸ƒå±€ï¼ŒcssClasså¯¹åº”çœŸå®å›¾ç‰‡ï¼‰
        const planets = [
            { id: 'sun',     name: 'å¤ªé˜³',   radius: 44, color: '#FDB813', unlockStage: 0, isSun: true,  cssClass: 'p-sun',     clickMulti: 0  },
            { id: 'mercury', name: 'æ°´æ˜Ÿ',   distance: 105, angle: 15,  radius: 9,  color: '#8C7853', unlockStage: 2, cssClass: 'p-mercury', clickMulti: 2  },
            { id: 'venus',   name: 'é‡‘æ˜Ÿ',   distance: 148, angle: 55,  radius: 13, color: '#E8C07D', unlockStage: 2, cssClass: 'p-venus',   clickMulti: 3  },
            { id: 'earth',   name: 'åœ°çƒ',   distance: 192, angle: 100, radius: 16, color: '#4A90E2', unlockStage: 0, cssClass: 'p-earth',   clickMulti: 1  },
            { id: 'moon',    name: 'æœˆçƒ',   distance: 222, angle: 113, radius: 9,  color: '#CCCCCC', unlockStage: 1, cssClass: 'p-moon',    clickMulti: 2  },
            { id: 'mars',    name: 'ç«æ˜Ÿ',   distance: 252, angle: 148, radius: 12, color: '#D94A2E', unlockStage: 2, cssClass: 'p-mars',    clickMulti: 4  },
            { id: 'jupiter', name: 'æœ¨æ˜Ÿ',   distance: 328, angle: 195, radius: 30, color: '#C88B3A', unlockStage: 3, cssClass: 'p-jupiter', clickMulti: 8  },
            { id: 'saturn',  name: 'åœŸæ˜Ÿ',   distance: 385, angle: 238, radius: 25, color: '#FAD5A5', unlockStage: 3, cssClass: 'p-saturn',  clickMulti: 10 },
            { id: 'uranus',  name: 'å¤©ç‹æ˜Ÿ', distance: 430, angle: 278, radius: 19, color: '#4FD5D6', unlockStage: 3, cssClass: 'p-uranus',  clickMulti: 12 },
            { id: 'neptune', name: 'æµ·ç‹æ˜Ÿ', distance: 468, angle: 320, radius: 17, color: '#4166F5', unlockStage: 3, cssClass: 'p-neptune', clickMulti: 15 }
        ];

        // å‡çº§é…ç½®
        const upgradesConfig = {
            mining: [
                { id: 'm1', name: 'å¤ªé˜³èƒ½æ¿', icon: 'â˜€ï¸', baseProduction: 2, baseCost: 10, costMult: 1.12 },
                { id: 'm2', name: 'é£åŠ›å‘ç”µ', icon: 'ğŸ’¨', baseProduction: 10, baseCost: 50, costMult: 1.12 },
                { id: 'm3', name: 'æ ¸ç”µç«™', icon: 'âš›ï¸', baseProduction: 50, baseCost: 300, costMult: 1.12 },
                { id: 'm4', name: 'èšå˜ååº”å †', icon: 'âš¡', baseProduction: 200, baseCost: 1500, costMult: 1.12 },
                { id: 'm5', name: 'åç‰©è´¨å‘ç”µ', icon: 'ğŸ’', baseProduction: 1000, baseCost: 8000, costMult: 1.12 }
            ],
            factory: [
                { id: 'f1', name: 'åŸºç¡€å·¥å‚', icon: 'ğŸ­', baseProduction: 1, baseCost: 50, costMult: 1.12, outputType: 'credits' },
                { id: 'f2', name: 'è‡ªåŠ¨åŒ–äº§çº¿', icon: 'ğŸ¤–', baseProduction: 5, baseCost: 250, costMult: 1.12, outputType: 'credits' },
                { id: 'f3', name: 'çº³ç±³å·¥å‚', icon: 'ğŸ”¬', baseProduction: 25, baseCost: 1200, costMult: 1.12, outputType: 'credits' },
                { id: 'f4', name: 'é‡å­åˆ¶é€ ', icon: 'âš›ï¸', baseProduction: 125, baseCost: 6000, costMult: 1.12, outputType: 'credits' }
            ],
            science: [
                { id: 's1', name: 'ç ”ç©¶å®éªŒå®¤', icon: 'ğŸ”¬', baseProduction: 0.5, baseCost: 100, costMult: 1.12, outputType: 'science' },
                { id: 's2', name: 'AIè®¡ç®—ä¸­å¿ƒ', icon: 'ğŸ§ ', baseProduction: 2, baseCost: 500, costMult: 1.12, outputType: 'science' },
                { id: 's3', name: 'é‡å­è®¡ç®—æœº', icon: 'ğŸ’»', baseProduction: 10, baseCost: 2500, costMult: 1.12, outputType: 'science' },
                { id: 's4', name: 'è¶…ç»´ç ”ç©¶ç«™', icon: 'ğŸŒ€', baseProduction: 50, baseCost: 12000, costMult: 1.12, outputType: 'science' }
            ],
            special: [
                { id: 'sp1', name: 'å¤ªç©ºç”µæ¢¯', icon: 'ğŸš¡', baseProduction: 5, baseCost: 500, costMult: 1.15, bonus: 'click' },
                { id: 'sp2', name: 'æˆ´æ£®çƒåŸå‹', icon: 'ğŸŒŸ', baseProduction: 100, baseCost: 5000, costMult: 1.15, bonus: 'all' },
                { id: 'sp3', name: 'æ—¶ç©ºåŠ é€Ÿå™¨', icon: 'â°', baseProduction: 0, baseCost: 25000, costMult: 1.2, bonus: 'speed' }
            ]
        };

        // Canvasè®¾ç½®
        const canvas = document.getElementById('universeCanvas');
        const ctx = canvas.getContext('2d');
        let centerX, centerY, scale = 1;
        const particles = [];

        // é™æ€æ˜Ÿç©ºæ”¹ä¸ºå‘å³æµåŠ¨çš„è§†å·®æ˜Ÿæµï¼ˆåªç”Ÿæˆä¸€æ¬¡ï¼‰
        const starfield = [];
        function initStarfield() {
            for (let i = 0; i < 220; i++) {
                starfield.push({
                    x: Math.random(),          // 0-1 æ¯”ä¾‹åæ ‡
                    y: Math.random(),
                    r: Math.random() * 1.4 + 0.2,
                    alpha: Math.random() * 0.6 + 0.3,
                    // ä¸‰ä¸ªå±‚æ¬¡é€Ÿåº¦ï¼šè¿œæ™¯æ…¢ã€è¿‘æ™¯å¿«ï¼Œå½¢æˆè§†å·®
                    speed: Math.random() * 0.00012 + 0.00003,
                    offset: Math.random() * Math.PI * 2
                });
            }
        }

        let starTick = 0;
        function drawStarfield() {
            starTick += 0.016;
            starfield.forEach(s => {
                // å‘å³ç§»åŠ¨
                s.x += s.speed;
                if (s.x > 1) s.x -= 1;   // è¶…å‡ºå³è¾¹ä»å·¦ä¾§é‡æ–°å‡ºç°

                const twinkle = 0.7 + 0.3 * Math.sin(starTick * 2 + s.offset);
                ctx.fillStyle = `rgba(255,255,255,${s.alpha * twinkle})`;
                ctx.beginPath();
                ctx.arc(s.x * canvas.width, s.y * canvas.height, s.r, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            centerX = canvas.width / 2;
            // å¤ªé˜³ç³»ä¸­å¿ƒæ”¾åœ¨å±å¹•ä¸ŠåŠéƒ¨ï¼Œé¿å¼€åº•éƒ¨å‡çº§é¢æ¿ï¼ˆçº¦260pxé«˜ï¼‰
            const uiTopHeight = 160;
            const bottomPanelHeight = 260;
            const availableH = canvas.height - uiTopHeight - bottomPanelHeight;
            centerY = uiTopHeight + availableH / 2;
            // è‡ªé€‚åº”ç¼©æ”¾ï¼šè®©æœ€è¿œè¡Œæ˜Ÿï¼ˆæµ·ç‹æ˜Ÿdistance=450ï¼‰å®Œæ•´æ˜¾ç¤º
            const availableW = canvas.width * 0.9;
            scale = Math.min(availableW, availableH) / (450 * 2 + 80);
        }

        // ç»˜åˆ¶å¤ªé˜³ç³»
        // â”€â”€ Canvasï¼šåªç”»æ˜Ÿç©ºã€è½¨é“åœˆã€å…‰è·¯ã€ç²’å­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function drawSolarSystem() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawStarfield();

            // è½¨é“åœˆï¼ˆå·²è§£é”é˜¶æ®µæ‰ç”»ï¼Œæœˆçƒè½¨é“ä¸ç”»é¿å…æ‚ä¹±ï¼‰
            planets.forEach(planet => {
                if (planet.isSun || planet.id === 'moon') return;
                if (game.currentStage < planet.unlockStage) return;
                ctx.strokeStyle = 'rgba(255,255,255,0.08)';
                ctx.lineWidth = 1;
                ctx.setLineDash([4, 8]);
                ctx.beginPath();
                ctx.arc(centerX, centerY, planet.distance * scale, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
            });

            drawEnergyLinks();
            updateParticles();
            updatePlanetDivs();   // åŒæ­¥CSSè¡Œæ˜Ÿä½ç½®
        }

        // â”€â”€ CSSè¡Œæ˜Ÿdivï¼šåˆå§‹åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function initPlanetDivs() {
            const layer = document.getElementById('planetLayer');
            planets.forEach(planet => {
                const div = document.createElement('div');
                div.className = `planet-div ${planet.cssClass} locked`;
                div.id = `pdiv-${planet.id}`;
                // åˆå§‹å°ºå¯¸ï¼ˆresizeCanvasåä¼šåœ¨updatePlanetDivsé‡Œæ›´æ–°ï¼‰
                const r = Math.max(planet.radius, planet.isSun ? 32 : 8);
                div.style.width  = r * 2 + 'px';
                div.style.height = r * 2 + 'px';
                div.style.left   = '-9999px';
                div.style.top    = '-9999px';

                if (!planet.isSun) {
                    div.addEventListener('click', (e) => {
                        if (div.classList.contains('locked')) return;
                        handlePlanetClick(planet, e.clientX, e.clientY);
                    });
                }
                layer.appendChild(div);
            });
        }

        // â”€â”€ CSSè¡Œæ˜Ÿdivï¼šæ¯å¸§åŒæ­¥ä½ç½®å’Œè§£é”çŠ¶æ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function updatePlanetDivs() {
            planets.forEach(planet => {
                const div = document.getElementById(`pdiv-${planet.id}`);
                if (!div) return;

                const unlocked = game.unlockedPlanets.includes(planet.id)
                              || game.currentStage >= planet.unlockStage;
                const drawR = Math.max(planet.radius * scale, planet.isSun ? 32 : 8);
                let x, y;
                if (planet.isSun) {
                    x = centerX; y = centerY;
                } else {
                    const rad = planet.angle * Math.PI / 180;
                    x = centerX + Math.cos(rad) * planet.distance * scale;
                    y = centerY + Math.sin(rad)  * planet.distance * scale;
                }

                div.style.width  = drawR * 2 + 'px';
                div.style.height = drawR * 2 + 'px';
                div.style.left   = x + 'px';
                div.style.top    = y + 'px';

                if (unlocked && div.classList.contains('locked')) {
                    div.classList.remove('locked');
                    div.classList.add('appearing');
                    setTimeout(() => div.classList.remove('appearing'), 900);
                } else if (!unlocked && !div.classList.contains('locked')) {
                    div.classList.add('locked');
                }

                planet.screenX = x;
                planet.screenY = y;
                planet.drawR   = drawR;
            });
        }

        // å…‰è·¯ç³»ç»Ÿ
        function drawEnergyLinks() {
            const earth = planets.find(p => p.id === 'earth');
            
            game.unlockedPlanets.forEach(planetId => {
                if (planetId === 'earth' || planetId === 'sun') return;
                
                const planet = planets.find(p => p.id === planetId);
                if (!planet || !planet.screenX) return;

                // ç»˜åˆ¶å…‰è·¯
                const gradient = ctx.createLinearGradient(
                    earth.screenX, earth.screenY,
                    planet.screenX, planet.screenY
                );
                gradient.addColorStop(0, 'rgba(251, 191, 36, 0.6)');
                gradient.addColorStop(0.5, 'rgba(251, 191, 36, 0.8)');
                gradient.addColorStop(1, 'rgba(251, 191, 36, 0.6)');

                ctx.strokeStyle = gradient;
                ctx.lineWidth = 2;
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#fbbf24';
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(earth.screenX, earth.screenY);
                ctx.lineTo(planet.screenX, planet.screenY);
                ctx.stroke();
                ctx.setLineDash([]);
                ctx.shadowBlur = 0;
            });
        }

        // ç²’å­ç³»ç»Ÿ
        function createParticle(x, y, targetX, targetY) {
            particles.push({
                x, y, targetX, targetY,
                vx: (targetX - x) / 50,
                vy: (targetY - y) / 50,
                life: 50,
                maxLife: 50
            });
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;

                const alpha = p.life / p.maxLife;
                ctx.fillStyle = `rgba(251, 191, 36, ${alpha})`;
                ctx.shadowBlur = 5;
                ctx.shadowColor = '#fbbf24';
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;

                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        // ç‚¹å‡»æ£€æµ‹
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;

            // ä»æœ€å¤–å±‚è¡Œæ˜Ÿå¾€å†…éå†ï¼Œä¼˜å…ˆå‘½ä¸­å¤–å±‚
            [...planets].reverse().forEach(planet => {
                if (planet.id === 'sun') return;
                if (!planet.screenX) return;

                const unlocked = game.unlockedPlanets.includes(planet.id) || game.currentStage >= planet.unlockStage;
                if (!unlocked) return;

                const dx = clickX - planet.screenX;
                const dy = clickY - planet.screenY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                // ç‚¹å‡»åŒºåŸŸç•¥å¤§äºè§†è§‰åŠå¾„ï¼Œæ‰‹æœºç«¯æ›´æ˜“ç‚¹ä¸­
                const hitRadius = (planet.drawR || planet.radius * scale) + 12;

                if (dist <= hitRadius) {
                    handlePlanetClick(planet, e.clientX, e.clientY);
                }
            });
        });

        function handlePlanetClick(planet, clientX, clientY) {
            const earned = game.clickPower * (planet.clickMulti || 1);
            game.energy += earned;
            game.totalEarned += earned;
            game.totalClicks++;

            // æµ®åŠ¨æ•°å­—
            const floatingNum = document.createElement('div');
            floatingNum.className = 'floating-number';
            floatingNum.textContent = '+' + formatNumber(earned);
            floatingNum.style.left = clientX + 'px';
            floatingNum.style.top = clientY + 'px';
            document.body.appendChild(floatingNum);
            setTimeout(() => floatingNum.remove(), 1500);

            // ç²’å­æ•ˆæœ
            if (planet.id !== 'earth') {
                const earth = planets.find(p => p.id === 'earth');
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        createParticle(planet.screenX, planet.screenY, earth.screenX, earth.screenY);
                    }, i * 100);
                }
            }

            updateUI();
            checkStageProgress();
        }

        // æ•°å­—æ ¼å¼åŒ–
        function formatNumber(num) {
            if (num < 1000) return Math.floor(num);
            if (num < 1000000) return (num / 1000).toFixed(1) + 'K';
            if (num < 1000000000) return (num / 1000000).toFixed(2) + 'M';
            return (num / 1000000000).toFixed(2) + 'B';
        }

        // åˆå§‹åŒ–å‡çº§
        function initUpgrades() {
            for (let category in upgradesConfig) {
                upgradesConfig[category].forEach(config => {
                    game.upgrades[category].push({ ...config, level: 0 });
                });
            }
        }

        // æ¸²æŸ“å‡çº§
        function renderUpgrades() {
            for (let category in game.upgrades) {
                const container = document.getElementById(category + 'Grid');
                container.innerHTML = '';

                game.upgrades[category].forEach(upgrade => {
                    const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMult, upgrade.level));
                    const canAfford = game.energy >= cost;
                    const production = upgrade.baseProduction * upgrade.level;

                    const card = document.createElement('div');
                    card.className = `upgrade-card ${canAfford ? '' : 'disabled'}`;
                    card.innerHTML = `
                        <div class="upgrade-card-header">
                            <span class="upgrade-name">${upgrade.icon} ${upgrade.name}</span>
                            <span class="upgrade-level-badge">Lv.${upgrade.level}</span>
                        </div>
                        <div class="upgrade-stats">
                            <span class="upgrade-cost-label">ğŸ’° ${formatNumber(cost)}</span>
                            <span class="upgrade-prod-label">${production > 0 ? '+' + formatNumber(production) + '/ç§’' : ''}</span>
                        </div>
                    `;

                    card.onclick = () => buyUpgrade(upgrade);
                    container.appendChild(card);
                });
            }
        }

        // è´­ä¹°å‡çº§
        function buyUpgrade(upgrade) {
            const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMult, upgrade.level));
            if (game.energy >= cost) {
                game.energy -= cost;
                upgrade.level++;
                
                if (upgrade.bonus === 'click') {
                    game.clickPower += upgrade.baseProduction;
                }

                updateProduction();
                renderUpgrades();
                updateUI();
            }
        }

        // æ›´æ–°äº§é‡
        function updateProduction() {
            game.energyPerSec = 0;
            game.creditsPerSec = 0;
            game.sciencePerSec = 0;

            for (let category in game.upgrades) {
                game.upgrades[category].forEach(upgrade => {
                    const production = upgrade.baseProduction * upgrade.level;
                    
                    if (upgrade.outputType === 'credits') {
                        game.creditsPerSec += production;
                    } else if (upgrade.outputType === 'science') {
                        game.sciencePerSec += production;
                    } else if (!upgrade.bonus) {
                        game.energyPerSec += production;
                    }
                });
            }

            const dysonLevel = game.upgrades.special.find(u => u.id === 'sp2')?.level || 0;
            if (dysonLevel > 0) {
                const bonus = 1 + (dysonLevel * 0.1);
                game.energyPerSec *= bonus;
                game.creditsPerSec *= bonus;
                game.sciencePerSec *= bonus;
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('energyVal').textContent = formatNumber(game.energy);
            document.getElementById('creditsVal').textContent = formatNumber(game.credits);
            document.getElementById('scienceVal').textContent = formatNumber(game.science);
            document.getElementById('energyRate').textContent = '+' + formatNumber(game.energyPerSec) + '/ç§’';
            document.getElementById('creditsRate').textContent = '+' + formatNumber(game.creditsPerSec) + '/ç§’';
            document.getElementById('scienceRate').textContent = '+' + formatNumber(game.sciencePerSec) + '/ç§’';
        }

        // æ£€æŸ¥é˜¶æ®µè¿›åº¦
        function checkStageProgress() {
            const currentStage = stages[game.currentStage];
            const nextStage = stages[game.currentStage + 1];

            if (nextStage && game.totalEarned >= nextStage.threshold) {
                advanceStage(nextStage);
            }

            if (nextStage) {
                const progress = ((game.totalEarned - currentStage.threshold) / 
                                 (nextStage.threshold - currentStage.threshold)) * 100;
                
                document.getElementById('progressBar').style.width = Math.min(progress, 100) + '%';
                document.getElementById('progressPercent').textContent = 
                    `${Math.floor(Math.min(progress, 100))}% (${formatNumber(game.totalEarned)} / ${formatNumber(nextStage.threshold)})`;
                document.getElementById('progressTitle').textContent = 'ğŸ¯ è·ç¦»' + nextStage.name;
            } else {
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercent').textContent = '100% - æ–‡æ˜å·…å³°';
                document.getElementById('progressTitle').textContent = 'ğŸ‰ æ–‡æ˜å·…å³°';
            }
        }

        // æ¨è¿›é˜¶æ®µ
        function advanceStage(stage) {
            game.currentStage = stage.id;
            document.getElementById('civLevel').textContent = stage.name;

            // è§£é”è¡Œæ˜Ÿ
            planets.forEach(planet => {
                if (planet.unlockStage === stage.id && planet.id !== 'sun') {
                    game.unlockedPlanets.push(planet.id);
                }
            });

            showMilestone(stage);
        }

        // æ˜¾ç¤ºé‡Œç¨‹ç¢‘
        function showMilestone(stage) {
            const modal = document.createElement('div');
            modal.className = 'milestone-overlay';
            modal.innerHTML = `
                <div class="milestone-box">
                    <div class="milestone-emoji">ğŸ‰</div>
                    <div class="milestone-heading">${stage.name}</div>
                    <div class="milestone-description">${stage.desc}</div>
                    <button class="milestone-cta">ç»§ç»­æ¢ç´¢å®‡å®™</button>
                </div>
            `;

            document.body.appendChild(modal);
            modal.querySelector('button').onclick = () => modal.remove();
        }

        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
            });
        });

        // æ¸¸æˆå¾ªç¯
        setInterval(() => {
            game.energy += game.energyPerSec / 10;
            game.credits += game.creditsPerSec / 10;
            game.science += game.sciencePerSec / 10;
            game.totalEarned += game.energyPerSec / 10;
            
            updateUI();
            checkStageProgress();
        }, 100);

        // æ¸²æŸ“å¾ªç¯
        function gameLoop() {
            drawSolarSystem();
            requestAnimationFrame(gameLoop);
        }

        // è‡ªåŠ¨ä¿å­˜
        setInterval(() => {
            game.lastSaveTime = Date.now();
            localStorage.setItem('spaceEmpireV4', JSON.stringify(game));
        }, 5000);

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saved = localStorage.getItem('spaceEmpireV4');
            if (!saved) return false;

            const savedGame = JSON.parse(saved);
            Object.assign(game, savedGame);

            const offlineTime = (Date.now() - game.lastSaveTime) / 1000;
            if (offlineTime > 60) {
                const offlineEnergy = game.energyPerSec * Math.min(offlineTime, 3600 * 4);
                showOfflineEarnings(offlineEnergy, offlineTime);
                game.energy += offlineEnergy;
            }

            document.getElementById('civLevel').textContent = stages[game.currentStage].name;
            updateProduction();
            return true;
        }

        function showOfflineEarnings(amount, time) {
            const hours = Math.floor(time / 3600);
            const minutes = Math.floor((time % 3600) / 60);

            const modal = document.createElement('div');
            modal.className = 'offline-modal';
            modal.innerHTML = `
                <div class="offline-box">
                    <div class="offline-title">æ¬¢è¿å›æ¥ï¼</div>
                    <div>ç¦»çº¿æ—¶é—´: ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ</div>
                    <div class="offline-amount">+${formatNumber(amount)}</div>
                    <div style="margin-bottom: 1.5rem;">èƒ½é‡å·²è‡ªåŠ¨æ”¶é›†</div>
                    <button class="offline-btn">å¤ªæ£’äº†ï¼</button>
                </div>
            `;

            document.body.appendChild(modal);
            modal.querySelector('button').onclick = () => {
                modal.remove();
                updateUI();
            };
        }

        // ===== å›½å®¶é…ç½® =====
        const countryConfigs = {
            usa:     { name: 'ç¾å›½',   flag: 'ğŸ‡ºğŸ‡¸', energy: 1000, clickPower: 3,  creditsMult: 2.0, scienceMult: 1.0, costDiscount: 1.0 },
            china:   { name: 'ä¸­å›½',   flag: 'ğŸ‡¨ğŸ‡³', energy: 300,  clickPower: 3,  creditsMult: 1.0, scienceMult: 1.5, costDiscount: 1.0 },
            russia:  { name: 'ä¿„ç½—æ–¯', flag: 'ğŸ‡·ğŸ‡º', energy: 400,  clickPower: 3,  creditsMult: 1.0, scienceMult: 1.0, costDiscount: 0.8 },
            germany: { name: 'å¾·å›½',   flag: 'ğŸ‡©ğŸ‡ª', energy: 200,  clickPower: 3,  creditsMult: 1.0, scienceMult: 1.0, costDiscount: 0.85 },
            india:   { name: 'å°åº¦',   flag: 'ğŸ‡®ğŸ‡³', energy: 150,  clickPower: 6,  creditsMult: 1.0, scienceMult: 1.0, costDiscount: 1.0 }
        };

        function selectCountry(id) {
            const cfg = countryConfigs[id];
            game.energy = cfg.energy;
            game.totalEarned = cfg.energy;
            game.clickPower = cfg.clickPower;
            game.country = id;
            game.countryName = cfg.name;
            game.costDiscount = cfg.costDiscount;
            game.creditsMult = cfg.creditsMult;
            game.scienceMult = cfg.scienceMult;

            // æ·¡å‡ºé€‰å›½ç•Œé¢ï¼Œæ·¡å…¥æ¸¸æˆ
            const screen = document.getElementById('countryScreen');
            screen.style.transition = 'opacity 0.8s ease';
            screen.style.opacity = '0';
            setTimeout(() => screen.remove(), 800);

            updateUI();
            checkStageProgress();
        }

        // é¢œè‰²å·¥å…·å‡½æ•°
        function lightenColor(hex, amount) {
            const num = parseInt(hex.replace('#',''), 16);
            const r = Math.min(255, (num >> 16) + amount);
            const g = Math.min(255, ((num >> 8) & 0xFF) + amount);
            const b = Math.min(255, (num & 0xFF) + amount);
            return `rgb(${r},${g},${b})`;
        }
        function darkenColor(hex, amount) {
            const num = parseInt(hex.replace('#',''), 16);
            const r = Math.max(0, (num >> 16) - amount);
            const g = Math.max(0, ((num >> 8) & 0xFF) - amount);
            const b = Math.max(0, (num & 0xFF) - amount);
            return `rgb(${r},${g},${b})`;
        }

        // åˆå§‹åŒ–
        window.addEventListener('resize', () => { resizeCanvas(); });
        resizeCanvas();
        initStarfield();
        initPlanetDivs();   // åˆ›å»ºCSSè¡Œæ˜Ÿdiv
        initUpgrades();

        // æœ‰å­˜æ¡£ç›´æ¥è¿›æ¸¸æˆï¼Œæ²¡æœ‰å­˜æ¡£æ˜¾ç¤ºé€‰å›½ç•Œé¢
        const hasSave = loadGame();
        if (hasSave) {
            document.getElementById('countryScreen').remove();
        }

        renderUpgrades();
        updateUI();
        checkStageProgress();
        gameLoop();

        window.addEventListener('beforeunload', () => {
            localStorage.setItem('spaceEmpireV4', JSON.stringify(game));
        });
    </script>
</body>
</html>