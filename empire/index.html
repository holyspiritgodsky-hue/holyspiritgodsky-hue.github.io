<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªç©ºå¸å›½ - å¾æœå¤ªé˜³ç³»</title>
    <style>
        :root {
            --font-ui:    'Courier New', Consolas, 'SF Mono', monospace;
            --font-body:  -apple-system, 'PingFang SC', 'Microsoft YaHei', 'Hiragino Sans GB', sans-serif;
            --font-mono:  'Courier New', Consolas, monospace;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e1a;
            --bg-panel: rgba(15, 23, 42, 0.92);
            --accent-cyan: #00d9ff;
            --accent-purple: #a855f7;
            --accent-gold: #fbbf24;
            --accent-green: #10b981;
            --text-white: #ffffff;
            --text-gray: #94a3b8;
        }

        body {
            font-family: var(--font-body);
            background: #000;
            color: var(--text-white);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* å®‡å®™ç”»å¸ƒ */
        .universe-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #0a0e1a 0%, #000 100%);
        }

        #universeCanvas {
            width: 100%;
            height: 100%;
        }

        /* UIå±‚ */
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-overlay > * {
            pointer-events: auto;
        }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 1.5rem 2rem;
            background: linear-gradient(to bottom, rgba(10, 14, 26, 0.95), transparent);
            backdrop-filter: blur(10px);
        }

        .game-title {
            text-align: center;
            font-family: var(--font-ui);
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 40px rgba(0, 217, 255, 0.4);
        }

        .civilization-level {
            text-align: center;
            font-family: var(--font-ui);
            font-size: 1.1rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
        }

        .resources-compact {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .resource-compact {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid rgba(0, 217, 255, 0.3);
        }

        .resource-icon-small {
            font-size: 1.5rem;
        }

        .resource-value-small {
            font-family: var(--font-mono);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .resource-rate-small {
            font-size: 0.8rem;
            color: var(--accent-green);
        }

        .home-btn {
            position: absolute;
            top: 1.5rem;
            right: 11rem;
            padding: 0.6rem 1.2rem;
            background: rgba(59, 130, 246, 0.15);
            border: 1.5px solid rgba(59, 130, 246, 0.4);
            border-radius: 10px;
            color: #3b82f6;
            font-family: var(--font-ui);
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            text-decoration: none;
            display: inline-block;
        }

        .home-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .reset-btn {
            position: absolute;
            top: 1.5rem;
            right: 2rem;
            padding: 0.6rem 1.2rem;
            background: rgba(220, 38, 38, 0.15);
            border: 1.5px solid rgba(220, 38, 38, 0.4);
            border-radius: 10px;
            color: #ef4444;
            font-family: var(--font-ui);
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .reset-btn:hover {
            background: rgba(220, 38, 38, 0.3);
            border-color: rgba(220, 38, 38, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        /* åº•éƒ¨æ§åˆ¶é¢æ¿ */
        .bottom-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(10, 14, 26, 0.95), transparent);
            backdrop-filter: blur(15px);
            padding: 1.5rem 2rem;
            max-height: 40vh;
            overflow-y: auto;
        }

        .panel-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab-button {
            font-family: var(--font-ui);
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .tab-button.active {
            background: rgba(0, 217, 255, 0.2);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .upgrades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .upgrade-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade-card:hover:not(.disabled) {
            background: rgba(0, 217, 255, 0.1);
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
        }

        .upgrade-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .upgrade-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .upgrade-name {
            font-weight: 700;
            font-size: 1rem;
        }

        .upgrade-level-badge {
            background: var(--accent-purple);
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .upgrade-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .upgrade-cost-label {
            color: var(--accent-gold);
            font-family: var(--font-mono);
            font-weight: 700;
        }

        .upgrade-prod-label {
            color: var(--accent-green);
        }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-panel);
            padding: 1.5rem 2rem;
            border-radius: 15px;
            border: 2px solid var(--accent-gold);
            text-align: center;
            min-width: 350px;
            pointer-events: none;
        }

        .progress-title-main {
            font-family: var(--font-ui);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 0.8rem;
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.5rem;
        }

        .progress-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple), var(--accent-gold));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.6);
        }

        .progress-percentage-text {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        /* é¡¶éƒ¨è¿›åº¦æ¡ */
        .top-progress-bar {
            position: absolute;
            bottom: 268px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15,23,42,0.75);
            padding: 0.5rem 1.2rem;
            border-radius: 20px;
            border: 1px solid rgba(251,191,36,0.35);
            min-width: 300px;
            max-width: 500px;
            width: 50%;
            backdrop-filter: blur(8px);
            pointer-events: none;
        }

        /* æç¤ºæ–‡æœ¬ */
        .hint-text {
            position: absolute;
            bottom: 45%;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-gray);
            font-size: 1rem;
            text-align: center;
            pointer-events: none;
            opacity: 0.8;
            animation: hintPulse 2s ease-in-out infinite;
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* é‡Œç¨‹ç¢‘å¼¹çª— */
        .milestone-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }

        .milestone-box {
            background: var(--bg-panel);
            border: 3px solid var(--accent-gold);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            max-width: 600px;
            animation: milestoneZoom 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 80px rgba(251, 191, 36, 0.6);
        }

        @keyframes milestoneZoom {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .milestone-emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: emojiFloat 0.6s ease infinite;
        }

        @keyframes emojiFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .milestone-heading {
            font-family: var(--font-ui);
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .milestone-description {
            font-size: 1.2rem;
            color: var(--text-gray);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .milestone-cta {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            padding: 1rem 3rem;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            font-family: var(--font-ui);
            transition: all 0.3s ease;
        }

        .milestone-cta:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.6);
        }

        /* æµ®åŠ¨æ•°å­— */
        .floating-number {
            position: fixed;
            font-family: var(--font-mono);
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-gold);
            pointer-events: none;
            animation: floatUpAnim 1.5s ease-out forwards;
            text-shadow: 0 0 10px var(--accent-gold);
            z-index: 500;
        }

        @keyframes floatUpAnim {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        /* ç¦»çº¿æ”¶ç›Š */
        .offline-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            animation: fadeIn 0.5s ease;
        }

        .offline-box {
            background: var(--bg-panel);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 60px rgba(0, 217, 255, 0.4);
            max-width: 500px;
        }

        .offline-title {
            font-family: var(--font-ui);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-cyan);
        }

        .offline-amount {
            font-family: var(--font-mono);
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent-gold);
            margin: 1.5rem 0;
            text-shadow: 0 0 30px var(--accent-gold);
        }

        .offline-btn {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            padding: 1rem 3rem;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: var(--font-ui);
        }

        .offline-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.4);
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .game-title {
                font-size: 1.5rem;
                margin-bottom: 0.3rem;
            }

            .civilization-level {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .top-bar {
                padding: 1rem 1rem;
            }

            .home-btn, .reset-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
                top: 1rem;
            }

            .home-btn {
                right: 7rem;
            }

            .reset-btn {
                right: 1rem;
            }

            .resources-compact {
                gap: 0.8rem;
            }

            .resource-compact {
                padding: 0.3rem 0.6rem;
            }

            .resource-icon-small {
                font-size: 1.2rem;
            }

            .resource-value-small {
                font-size: 1rem;
            }

            .resource-rate-small {
                font-size: 0.7rem;
            }

            .bottom-panel {
                max-height: 45vh;
                padding: 1rem 0.8rem;
            }

            .panel-tabs {
                margin-bottom: 0.8rem;
            }

            .tab-button {
                padding: 0.5rem 0.8rem;
                font-size: 0.8rem;
            }

            .upgrades-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }

            .upgrade-card {
                padding: 0.8rem;
            }

            .progress-indicator {
                min-width: 260px;
                padding: 0.8rem 1rem;
                bottom: 45vh;
            }

            /* å›½å®¶é€‰æ‹©ç•Œé¢ä¼˜åŒ– */
            .country-screen {
                padding: 1rem;
            }

            .country-screen-title {
                font-size: 1.6rem;
                margin-bottom: 0.3rem;
            }

            .country-screen-subtitle {
                font-size: 0.85rem;
                margin-bottom: 1rem;
            }

            .country-grid {
                gap: 0.8rem;
                grid-template-columns: 1fr;
                max-width: 100%;
            }

            .country-card {
                padding: 1rem;
                min-height: 180px;
            }

            .country-flag {
                font-size: 2rem;
            }

            .country-name {
                font-size: 1rem;
            }

            .country-stats {
                font-size: 0.75rem;
                line-height: 1.5;
            }

            .country-tag {
                font-size: 0.65rem;
                padding: 0.15rem 0.5rem;
            }

            /* é¡¶éƒ¨è¿›åº¦æ¡ç§»åŠ¨ç«¯ä½ç½® */
            .top-progress-bar {
                bottom: calc(45vh + 10px);
                width: 80%;
                min-width: 260px;
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== CSSè¡Œæ˜Ÿå±‚ï¼ˆå åœ¨canvasä¸Šæ–¹ï¼Œé¿å¼€è·¨åŸŸé™åˆ¶ï¼‰===== */
        #planetLayer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;   /* é»˜è®¤ä¸æ‹¦æˆªï¼Œè¡Œæ˜Ÿè‡ªå·±å¼€å¯ */
            z-index: 10;
        }

        .planet-div {
            position: absolute;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            transform: translate(-50%, -50%);
            cursor: pointer;
            pointer-events: auto;
            transition: filter 0.4s ease, opacity 0.6s ease, box-shadow 0.4s ease;
            box-shadow: 0 0 20px rgba(255,255,255,0.15);
        }

        .planet-div:hover { filter: brightness(1.25); transform: translate(-50%,-50%) scale(1.08); }
        .planet-div:active { transform: translate(-50%,-50%) scale(0.94); }

        .planet-div.locked {
            filter: grayscale(1) brightness(0.3);
            pointer-events: none;
            opacity: 0;             /* æœªè§£é”å®Œå…¨éšè— */
        }

        /* å„æ˜ŸçƒçœŸå®å›¾ç‰‡ï¼ˆå…¬å¼€CDNï¼ŒåŒåŸŸä»£ç†ï¼‰ */
        .p-sun     { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/b/b4/The_Sun_by_the_Atmospheric_Imaging_Assembly_of_NASA%27s_Solar_Dynamics_Observatory_-_20100819.jpg/480px-The_Sun_by_the_Atmospheric_Imaging_Assembly_of_NASA%27s_Solar_Dynamics_Observatory_-_20100819.jpg');
                     box-shadow: 0 0 80px rgba(253,200,50,0.9), 0 0 160px rgba(253,150,30,0.4); pointer-events:none; }
        .p-mercury { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Mercury_in_true_color.jpg/240px-Mercury_in_true_color.jpg'); }
        .p-venus   { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Venus-real_color.jpg/240px-Venus-real_color.jpg'); }
        .p-earth   { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/The_Earth_seen_from_Apollo_17.jpg/240px-The_Earth_seen_from_Apollo_17.jpg');
                     box-shadow: 0 0 35px rgba(74,144,226,0.7); }
        .p-moon    { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/FullMoon2010.jpg/240px-FullMoon2010.jpg'); }
        .p-mars    { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/0/02/OSIRIS_Mars_true_color.jpg/240px-OSIRIS_Mars_true_color.jpg');
                     box-shadow: 0 0 30px rgba(217,74,46,0.6); }
        .p-jupiter { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/2/2b/Jupiter_and_its_shrunken_Great_Red_Spot.jpg/240px-Jupiter_and_its_shrunken_Great_Red_Spot.jpg');
                     box-shadow: 0 0 40px rgba(200,139,58,0.5); }
        .p-saturn  { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Saturn_during_Equinox.jpg/320px-Saturn_during_Equinox.jpg');
                     box-shadow: 0 0 40px rgba(250,213,165,0.5); }
        .p-uranus  { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/3/3d/Uranus2.jpg/240px-Uranus2.jpg');
                     box-shadow: 0 0 30px rgba(79,213,214,0.5); }
        .p-neptune { background-image: url('https://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg/240px-Neptune_-_Voyager_2_%2829347980845%29_flatten_crop.jpg');
                     box-shadow: 0 0 30px rgba(65,102,245,0.5); }

        /* åœŸæ˜Ÿå…‰ç¯ï¼ˆä¼ªå…ƒç´ ï¼Œçº¯CSSï¼‰ */
        .p-saturn::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 185%; height: 50%;
            border: 4px solid rgba(210,180,140,0.55);
            border-radius: 50%;
            transform: translate(-50%,-50%) rotateX(65deg);
            pointer-events: none;
        }

        /* è¡Œæ˜Ÿè‡ªè½¬åŠ¨ç”» */
        @keyframes spinSlow  { from{background-position:0% center} to{background-position:200% center} }
        .p-earth   { animation: spinSlow 60s linear infinite; }
        .p-venus   { animation: spinSlow 90s linear infinite; }
        .p-mars    { animation: spinSlow 55s linear infinite; }
        .p-jupiter { animation: spinSlow 30s linear infinite; }

        /* è§£é”æ—¶çš„å‡ºç°åŠ¨ç”» */
        @keyframes planetAppear {
            0%   { transform: translate(-50%,-50%) scale(0); opacity:0; }
            60%  { transform: translate(-50%,-50%) scale(1.15); }
            100% { transform: translate(-50%,-50%) scale(1);  opacity:1; }
        }
        .planet-div.appearing { animation: planetAppear 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards; }

        /* ===== é€‰å›½å®¶å¼€åœºç•Œé¢ ===== */
        .country-screen {
            position: fixed;
            inset: 0;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 1s ease;
        }

        .country-screen-title {
            font-family: var(--font-ui);
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .country-screen-subtitle {
            color: var(--text-gray);
            font-size: 1rem;
            margin-bottom: 2rem;
            text-align: center;
            font-style: italic;
            max-width: 500px;
            line-height: 1.6;
        }

        .country-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 900px;
        }

        .country-card {
            background: rgba(15, 23, 42, 0.85);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 14px;
            padding: 1.4rem 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            min-height: 260px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .country-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.75), rgba(15,23,42,0.85));
            opacity: 1;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .country-card:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0,217,255,0.25);
        }

        .country-card:hover::before { opacity: 0.7; }

        .country-card.vip {
            border-color: rgba(251,191,36,0.4);
        }

        .country-card.vip:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 10px 30px rgba(251,191,36,0.3);
        }

        .country-flag {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            display: block;
            position: relative;
            z-index: 2;
        }

        .country-name {
            font-family: var(--font-ui);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--text-white);
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 8px rgba(0,0,0,0.8);
        }

        .country-stats {
            font-size: 0.82rem;
            color: var(--text-gray);
            line-height: 1.7;
            position: relative;
            z-index: 2;
        }

        .country-stats span {
            display: block;
            text-shadow: 0 1px 4px rgba(0,0,0,0.7);
        }

        .country-stats .highlight {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        .country-tag {
            display: inline-block;
            margin-top: 0.6rem;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.72rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .tag-vip { background: rgba(251,191,36,0.2); color: var(--accent-gold); border: 1px solid rgba(251,191,36,0.4); }

        /* å›½å®¶ç‰¹å®šèƒŒæ™¯å›¾ç‰‡ */
        .country-usa { background-image: url('https://flagcdn.com/w640/us.png'); }
        .country-china { background-image: url('https://flagcdn.com/w640/cn.png'); }
        .country-russia { background-image: url('https://flagcdn.com/w640/ru.png'); }
        .country-germany { background-image: url('https://flagcdn.com/w640/de.png'); }
        .country-japan { background-image: url('https://flagcdn.com/w640/jp.png'); }
        .tag-event { background: rgba(168,85,247,0.2); color: var(--accent-purple); border: 1px solid rgba(168,85,247,0.4); }
        .tag-balanced { background: rgba(16,185,129,0.2); color: var(--accent-green); border: 1px solid rgba(16,185,129,0.4); }
    </style>
</head>
<body>
    <!-- å®‡å®™ç”»å¸ƒï¼ˆåªç»˜åˆ¶æ˜Ÿç©ºã€è½¨é“çº¿ã€å…‰è·¯ã€ç²’å­ï¼‰ -->
    <div class="universe-canvas">
        <canvas id="universeCanvas"></canvas>
    </div>

    <!-- CSSè¡Œæ˜Ÿå±‚ï¼ˆçœŸå®å›¾ç‰‡ï¼Œé¿å¼€Canvasè·¨åŸŸé™åˆ¶ï¼‰ -->
    <div id="planetLayer"></div>

    <!-- é€‰å›½å®¶å¼€åœºç•Œé¢ -->
    <div class="country-screen" id="countryScreen">
        
        <div class="country-screen-subtitle">
            "æˆ‘ä»¬é‡‡çŸ¿ï¼Œæˆ‘ä»¬æœé›†èƒ½æºï¼Œæˆ‘ä»¬å‘å±•ç§‘æŠ€ï¼Œæˆ‘ä»¬è¿ˆå‘é“¶æ²³"
        </div>
        <div class="country-grid">
            <div class="country-card country-usa vip" onclick="selectCountry('usa')">
                <span class="country-flag">ğŸ‡ºğŸ‡¸</span>
                <div class="country-name">ç¾å›½</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">500</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">50</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">100</b></span>
                    <span class="country-tag tag-vip">â˜… VIP ä¼˜åŠ¿</span>
                </div>
            </div>
            <div class="country-card country-china" onclick="selectCountry('china')">
                <span class="country-flag">ğŸ‡¨ğŸ‡³</span>
                <div class="country-name">ä¸­å›½</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">300</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">80</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">100</b></span>
                    <span class="country-tag tag-event">ç‹¬æœ‰äº‹ä»¶é“¾</span>
                </div>
            </div>
            <div class="country-card country-russia" onclick="selectCountry('russia')">
                <span class="country-flag">ğŸ‡·ğŸ‡º</span>
                <div class="country-name">ä¿„ç½—æ–¯</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">400</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">60</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">100</b></span>
                    <span class="country-tag tag-balanced">å‡è¡¡å‘å±•</span>
                </div>
            </div>
            <div class="country-card country-germany" onclick="selectCountry('germany')">
                <span class="country-flag">ğŸ‡©ğŸ‡ª</span>
                <div class="country-name">å¾·å›½</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">250</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">70</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">100</b></span>
                    <span class="country-tag tag-balanced">å·¥ä¸šå¼ºå›½</span>
                </div>
            </div>
            <div class="country-card country-japan" onclick="selectCountry('japan')">
                <span class="country-flag">ğŸ‡¯ğŸ‡µ</span>
                <div class="country-name">æ—¥æœ¬</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">200</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">50</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">150</b></span>
                    <span class="country-tag tag-event">ç‹¬æœ‰äº‹ä»¶é“¾</span>
                </div>
            </div>
        </div>
    </div>

    <!-- UIå±‚ -->
    <div class="ui-overlay">
        <!-- é¡¶éƒ¨æ  -->
        <div class="top-bar">
            <a href="https://gameart.top" class="home-btn" target="_blank">ğŸ  é¦–é¡µ</a>
            <button class="reset-btn" onclick="resetGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
            <div class="game-title">ğŸŒŒ å¤ªç©ºå¸å›½</div>
            <div class="civilization-level" id="civLevel">ğŸŒ è¡Œæ˜Ÿæ–‡æ˜</div>
            <div class="resources-compact">
                <div class="resource-compact">
                    <span class="resource-icon-small">ğŸ’</span>
                    <div>
                        <div class="resource-value-small" id="oreVal">0</div>
                        <div class="resource-rate-small" id="oreRate">+0/ç§’</div>
                    </div>
                </div>
                <div class="resource-compact">
                    <span class="resource-icon-small">âš¡</span>
                    <div>
                        <div class="resource-value-small" id="energyVal">0</div>
                        <div class="resource-rate-small" id="energyRate">+0/ç§’</div>
                    </div>
                </div>
                <div class="resource-compact">
                    <span class="resource-icon-small">ğŸ”¬</span>
                    <div>
                        <div class="resource-value-small" id="techVal">0</div>
                        <div class="resource-rate-small" id="techRate">+0/ç§’</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ï¼šå›ºå®šåœ¨åº•éƒ¨é¢æ¿æ­£ä¸Šæ–¹ -->
        <div class="top-progress-bar">
            <div style="display:flex;align-items:center;gap:0.8rem;">
                <div id="progressTitle" style="font-family:var(--font-ui);font-size:0.75rem;font-weight:700;color:var(--accent-gold);white-space:nowrap;flex-shrink:0;">ğŸ¯ è·ç¦»åœ°æœˆç³»ç»Ÿ</div>
                <div style="flex:1;height:10px;background:rgba(0,0,0,0.5);border-radius:5px;overflow:hidden;">
                    <div id="progressBar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-purple),var(--accent-gold));border-radius:5px;transition:width 0.5s ease;box-shadow:0 0 8px rgba(0,217,255,0.5);"></div>
                </div>
                <div id="progressPercent" style="font-family:var(--font-mono);font-size:0.75rem;color:var(--text-gray);white-space:nowrap;flex-shrink:0;">0%</div>
            </div>
        </div>

        <!-- æç¤ºæ–‡æœ¬å·²ç§»é™¤ï¼Œç”±ç‚¹å‡»åé¦ˆä»£æ›¿ -->

        <!-- åº•éƒ¨é¢æ¿ -->
        <div class="bottom-panel">
            <div class="panel-tabs">
                <button class="tab-button active" data-tab="mining">ğŸ’ è‡ªåŠ¨äº§çº¿</button>
                <button class="tab-button" data-tab="energy">âš¡ è‡ªåŠ¨èƒ½æº</button>
                <button class="tab-button" data-tab="tech">ğŸ”¬ ç§‘æŠ€ç³»ç»Ÿ</button>
                <button class="tab-button" data-tab="special">âœ¨ ç‰¹æ®Š</button>
            </div>

            <div class="tab-content active" id="tab-mining">
                <div class="upgrades-grid" id="miningGrid"></div>
            </div>
            <div class="tab-content" id="tab-energy">
                <div class="upgrades-grid" id="energyGrid"></div>
            </div>
            <div class="tab-content" id="tab-tech">
                <div class="upgrades-grid" id="techGrid"></div>
            </div>
            <div class="tab-content" id="tab-special">
                <div class="upgrades-grid" id="specialGrid"></div>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const game = {
            ore: 0,           // çŸ¿çŸ³ï¼ˆåŸºç¡€èµ„æºï¼Œç‚¹å‡»å’Œå·¥å‚äº§å‡ºï¼‰
            energy: 0,        // èƒ½æºï¼ˆç”¨çŸ¿çŸ³ç”Ÿäº§ï¼‰
            tech: 0,          // ç§‘æŠ€ç‚¹ï¼ˆç”¨èƒ½æºé©±åŠ¨ï¼‰
            techLevel: 0,     // ç§‘æŠ€ç­‰çº§ 0-4
            clickPower: 100,  // ç‚¹å‡»è·å¾—çŸ¿çŸ³
            orePerSec: 0,     // çŸ¿çŸ³äº§é‡
            energyPerSec: 0,  // èƒ½æºäº§é‡
            techPerSec: 0,    // ç§‘æŠ€äº§é‡
            totalEarned: 0,
            totalClicks: 0,
            currentStage: 0,
            lastSaveTime: Date.now(),
            unlockedPlanets: ['earth'],
            upgrades: { mining: [], energy: [], tech: [], special: [] }
        };

        // æ–‡æ˜é˜¶æ®µ
        const stages = [
            { id: 0, name: 'ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', desc: 'äººç±»æ–‡æ˜çš„èµ·ç‚¹', threshold: 0, nextThreshold: 200, view: 'earth' },
            { id: 1, name: 'ğŸŒ™ åœ°æœˆç³»ç»Ÿ', desc: 'æœˆçƒæˆä¸ºäººç±»ç¬¬äºŒå®¶å›­', threshold: 200, nextThreshold: 1000, view: 'inner' },
            { id: 2, name: 'ğŸª å†…è¡Œæ˜Ÿå¾æœ', desc: 'æ°´æ˜Ÿã€é‡‘æ˜Ÿã€ç«æ˜Ÿæ®–æ°‘å®Œæˆ', threshold: 1000, nextThreshold: 5000, view: 'inner' },
            { id: 3, name: 'â˜€ï¸ å¤ªé˜³ç³»éœ¸ä¸»', desc: 'æŒæ§å…«å¤§è¡Œæ˜Ÿ', threshold: 5000, nextThreshold: 25000, view: 'solar' },
            { id: 4, name: 'ğŸŒŒ é“¶æ²³æ¢ç´¢è€…', desc: 'æ˜Ÿé™…æ—¶ä»£æ¥ä¸´', threshold: 25000, nextThreshold: Infinity, view: 'galaxy' }
        ];

        // è¡Œæ˜Ÿæ•°æ®
        // è¡Œæ˜Ÿæ•°æ®ï¼ˆè·ç¦»/è§’åº¦å†³å®šå¸ƒå±€ï¼ŒcssClasså¯¹åº”çœŸå®å›¾ç‰‡ï¼‰
        const planets = [
            { id: 'sun',     name: 'å¤ªé˜³',   radius: 44, color: '#FDB813', unlockStage: 0, isSun: true,  cssClass: 'p-sun',     clickMulti: 0  },
            { id: 'mercury', name: 'æ°´æ˜Ÿ',   distance: 105, angle: 15,  radius: 9,  color: '#8C7853', unlockStage: 2, cssClass: 'p-mercury', clickMulti: 2  },
            { id: 'venus',   name: 'é‡‘æ˜Ÿ',   distance: 148, angle: 55,  radius: 13, color: '#E8C07D', unlockStage: 2, cssClass: 'p-venus',   clickMulti: 3  },
            { id: 'earth',   name: 'åœ°çƒ',   distance: 192, angle: 100, radius: 16, color: '#4A90E2', unlockStage: 0, cssClass: 'p-earth',   clickMulti: 1  },
            { id: 'moon',    name: 'æœˆçƒ',   distance: 222, angle: 113, radius: 9,  color: '#CCCCCC', unlockStage: 1, cssClass: 'p-moon',    clickMulti: 2  },
            { id: 'mars',    name: 'ç«æ˜Ÿ',   distance: 252, angle: 148, radius: 12, color: '#D94A2E', unlockStage: 2, cssClass: 'p-mars',    clickMulti: 4  },
            { id: 'jupiter', name: 'æœ¨æ˜Ÿ',   distance: 328, angle: 195, radius: 30, color: '#C88B3A', unlockStage: 3, cssClass: 'p-jupiter', clickMulti: 8  },
            { id: 'saturn',  name: 'åœŸæ˜Ÿ',   distance: 385, angle: 238, radius: 25, color: '#FAD5A5', unlockStage: 3, cssClass: 'p-saturn',  clickMulti: 10 },
            { id: 'uranus',  name: 'å¤©ç‹æ˜Ÿ', distance: 430, angle: 278, radius: 19, color: '#4FD5D6', unlockStage: 3, cssClass: 'p-uranus',  clickMulti: 12 },
            { id: 'neptune', name: 'æµ·ç‹æ˜Ÿ', distance: 468, angle: 320, radius: 17, color: '#4166F5', unlockStage: 3, cssClass: 'p-neptune', clickMulti: 15 }
        ];

        // å‡çº§é…ç½® - æ–°çš„èµ„æºé“¾æ¡ï¼šçŸ¿çŸ³â†’èƒ½æºâ†’ç§‘æŠ€
        const upgradesConfig = {
            // é‡‡çŸ¿è®¾æ–½ï¼šäº§å‡ºçŸ¿çŸ³ï¼ˆå…è´¹ï¼Œè‡ªåŠ¨äº§å‡ºï¼‰
            mining: [
                { id: 'm1', name: 'åŸºç¡€å·¥å‚', icon: 'ğŸ­', baseProduction: 2, baseCost: 50, costMult: 1.12, costType: 'ore', outputType: 'ore' },
                { id: 'm2', name: 'è‡ªåŠ¨äº§çº¿', icon: 'ğŸ¤–', baseProduction: 10, baseCost: 300, costMult: 1.12, costType: 'ore', outputType: 'ore' },
                { id: 'm3', name: 'çº³ç±³å·¥å‚', icon: 'âš™ï¸', baseProduction: 50, baseCost: 1500, costMult: 1.12, costType: 'ore', outputType: 'ore' },
                { id: 'm4', name: 'é‡å­å·¥å‚', icon: 'âš›ï¸', baseProduction: 250, baseCost: 8000, costMult: 1.12, costType: 'ore', outputType: 'ore' }
            ],
            // èƒ½æºè®¾æ–½ï¼šæ¶ˆè€—çŸ¿çŸ³ï¼Œäº§å‡ºèƒ½æº
            energy: [
                { id: 'e1', name: 'æ ¸ç”µç«™', icon: 'â˜¢ï¸', baseProduction: 3, baseCost: 100, costMult: 1.14, costType: 'ore', outputType: 'energy' },
                { id: 'e2', name: 'æ ¸èšå˜å †', icon: 'âš¡', baseProduction: 18, baseCost: 800, costMult: 1.14, costType: 'ore', outputType: 'energy' },
                { id: 'e3', name: 'å«æ˜Ÿå¤ªé˜³èƒ½', icon: 'ğŸ›°ï¸', baseProduction: 120, baseCost: 5000, costMult: 1.14, costType: 'ore', outputType: 'energy' },
                { id: 'e4', name: 'åç‰©è´¨å¼•æ“', icon: 'âœ¨', baseProduction: 800, baseCost: 30000, costMult: 1.14, costType: 'ore', outputType: 'energy' }
            ],
            // ç§‘æŠ€ç³»ç»Ÿï¼šæ¶ˆè€—èƒ½æºï¼Œè§£é”ç§‘æŠ€ç­‰çº§ï¼ˆæ¯ä¸ªåªèƒ½è´­ä¹°ä¸€æ¬¡ï¼‰
            tech: [
                { id: 't1', name: 'åœ°æœˆå¼•åŠ›æ¡¥', icon: 'ğŸŒ™', techLevel: 1, baseCost: 500, desc: 'è¿æ¥åœ°çƒä¸æœˆçƒï¼Œå¼€å¯æ–‡æ˜æ–°çºªå…ƒ', costType: 'energy', unlocked: false },
                { id: 't2', name: 'å¤ªé˜³ç³»å¼•åŠ›æ¡¥', icon: 'â˜€ï¸', techLevel: 2, baseCost: 3000, desc: 'æŒæ§å¤ªé˜³ç³»å†…è¡Œæ˜Ÿï¼Œæ–‡æ˜è·¨è¶Šå¼å‘å±•', costType: 'energy', unlocked: false },
                { id: 't3', name: 'é»‘æ´å¼•åŠ›æ¡¥', icon: 'âš«', techLevel: 3, baseCost: 20000, desc: 'åˆ©ç”¨é»‘æ´èƒ½é‡ï¼Œçªç ´æ—¶ç©ºé™åˆ¶', costType: 'energy', unlocked: false },
                { id: 't4', name: 'é“¶æ²³ç³»å¼•åŠ›æ¡¥', icon: 'ğŸŒŒ', techLevel: 4, baseCost: 150000, desc: 'é“¶æ²³æ–‡æ˜å·…å³°ï¼Œå¾æœæ˜Ÿè¾°å¤§æµ·', costType: 'energy', unlocked: false }
            ],
            special: [
                { id: 'sp1', name: 'å¤ªç©ºç”µæ¢¯', icon: 'ğŸš¡', baseProduction: 50, baseCost: 500, costMult: 1.15, costType: 'ore', bonus: 'click' },
                { id: 'sp2', name: 'æˆ´æ£®çƒ', icon: 'ğŸŒŸ', baseProduction: 0, baseCost: 10000, costMult: 1.18, costType: 'ore', bonus: 'energyBoost', boostValue: 2.0 },
                { id: 'sp3', name: 'æ—¶ç©ºåŠ é€Ÿå™¨', icon: 'â°', baseProduction: 0, baseCost: 50000, costMult: 1.2, costType: 'energy', bonus: 'speed', speedMult: 1.5 }
            ]
        };

        // Canvasè®¾ç½®
        const canvas = document.getElementById('universeCanvas');
        const ctx = canvas.getContext('2d');
        let centerX, centerY, scale = 1;
        const particles = [];

        // é™æ€æ˜Ÿç©ºæ”¹ä¸ºå‘å³æµåŠ¨çš„è§†å·®æ˜Ÿæµï¼ˆåªç”Ÿæˆä¸€æ¬¡ï¼‰
        const starfield = [];
        function initStarfield() {
            for (let i = 0; i < 220; i++) {
                starfield.push({
                    x: Math.random(),          // 0-1 æ¯”ä¾‹åæ ‡
                    y: Math.random(),
                    r: Math.random() * 1.4 + 0.2,
                    alpha: Math.random() * 0.6 + 0.3,
                    // ä¸‰ä¸ªå±‚æ¬¡é€Ÿåº¦ï¼šè¿œæ™¯æ…¢ã€è¿‘æ™¯å¿«ï¼Œå½¢æˆè§†å·®
                    speed: Math.random() * 0.0003 + 0.00008,
                    offset: Math.random() * Math.PI * 2
                });
            }
        }

        let starTick = 0;
        function drawStarfield() {
            starTick += 0.016;
            // æ ¹æ®ç§‘æŠ€ç­‰çº§è°ƒæ•´æ˜Ÿç©ºæ•ˆæœ
            const techLevel = game.techLevel || 0;
            const speedMultiplier = 1 + techLevel * 0.15;  // ç§‘æŠ€è¶Šé«˜ï¼Œæ˜Ÿç©ºæµåŠ¨è¶Šå¿«
            const brightnessBonus = techLevel * 0.08;      // ç§‘æŠ€è¶Šé«˜ï¼Œæ˜Ÿç©ºè¶Šäº®
            
            starfield.forEach(s => {
                // å‘å³ç§»åŠ¨
                s.x += s.speed * speedMultiplier;
                if (s.x > 1) s.x -= 1;   // è¶…å‡ºå³è¾¹ä»å·¦ä¾§é‡æ–°å‡ºç°

                const twinkle = 0.7 + 0.3 * Math.sin(starTick * 2 + s.offset);
                const finalAlpha = Math.min(1, (s.alpha + brightnessBonus) * twinkle);
                ctx.fillStyle = `rgba(255,255,255,${finalAlpha})`;
                ctx.beginPath();
                ctx.arc(s.x * canvas.width, s.y * canvas.height, s.r, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            centerX = canvas.width / 2;
            // å¤ªé˜³ç³»ä¸­å¿ƒæ”¾åœ¨å±å¹•ä¸ŠåŠéƒ¨ï¼Œé¿å¼€åº•éƒ¨å‡çº§é¢æ¿ï¼ˆçº¦260pxé«˜ï¼‰
            const uiTopHeight = 160;
            const bottomPanelHeight = 260;
            const availableH = canvas.height - uiTopHeight - bottomPanelHeight;
            centerY = uiTopHeight + availableH / 2;
            // è‡ªé€‚åº”ç¼©æ”¾ï¼šè®©æœ€è¿œè¡Œæ˜Ÿï¼ˆæµ·ç‹æ˜Ÿdistance=450ï¼‰å®Œæ•´æ˜¾ç¤º
            const availableW = canvas.width * 0.9;
            scale = Math.min(availableW, availableH) / (450 * 2 + 80);
        }

        // ç»˜åˆ¶å¤ªé˜³ç³»
        // â”€â”€ Canvasï¼šåªç”»æ˜Ÿç©ºã€è½¨é“åœˆã€å…‰è·¯ã€ç²’å­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function drawSolarSystem() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawStarfield();

            // è½¨é“åœˆï¼ˆå·²è§£é”é˜¶æ®µæ‰ç”»ï¼Œæœˆçƒè½¨é“ä¸ç”»é¿å…æ‚ä¹±ï¼‰
            planets.forEach(planet => {
                if (planet.isSun || planet.id === 'moon') return;
                if (game.currentStage < planet.unlockStage) return;
                ctx.strokeStyle = 'rgba(255,255,255,0.08)';
                ctx.lineWidth = 1;
                ctx.setLineDash([4, 8]);
                ctx.beginPath();
                ctx.arc(centerX, centerY, planet.distance * scale, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
            });

            drawEnergyLinks();
            updateParticles();
            updatePlanetDivs();   // åŒæ­¥CSSè¡Œæ˜Ÿä½ç½®
        }

        // â”€â”€ CSSè¡Œæ˜Ÿdivï¼šåˆå§‹åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function initPlanetDivs() {
            const layer = document.getElementById('planetLayer');
            planets.forEach(planet => {
                const div = document.createElement('div');
                div.className = `planet-div ${planet.cssClass} locked`;
                div.id = `pdiv-${planet.id}`;
                // åˆå§‹å°ºå¯¸ï¼ˆresizeCanvasåä¼šåœ¨updatePlanetDivsé‡Œæ›´æ–°ï¼‰
                const r = Math.max(planet.radius, planet.isSun ? 32 : 8);
                div.style.width  = r * 2 + 'px';
                div.style.height = r * 2 + 'px';
                div.style.left   = '-9999px';
                div.style.top    = '-9999px';

                if (!planet.isSun) {
                    div.addEventListener('click', (e) => {
                        if (div.classList.contains('locked')) return;
                        handlePlanetClick(planet, e.clientX, e.clientY);
                    });
                }
                layer.appendChild(div);
            });
        }

        // â”€â”€ CSSè¡Œæ˜Ÿdivï¼šæ¯å¸§åŒæ­¥ä½ç½®å’Œè§£é”çŠ¶æ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function updatePlanetDivs() {
            // æ ¹æ®ç§‘æŠ€ç­‰çº§å®šä¹‰æ˜Ÿçƒå…‰æ™•é¢œè‰²
            const techLevel = game.techLevel || 0;
            const glowColors = [
                'rgba(251, 191, 36, 0.5)',  // Lv0: é‡‘è‰²
                'rgba(0, 217, 255, 0.6)',   // Lv1: é’è‰²
                'rgba(168, 85, 247, 0.7)',  // Lv2: ç´«è‰²
                'rgba(255, 0, 255, 0.7)',   // Lv3: å“çº¢
                'rgba(255, 255, 255, 0.8)'  // Lv4: ç™½è‰²
            ];
            const glowColor = glowColors[Math.min(techLevel, 4)];
            const glowIntensity = 20 + techLevel * 10;
            
            planets.forEach(planet => {
                const div = document.getElementById(`pdiv-${planet.id}`);
                if (!div) return;

                const unlocked = game.unlockedPlanets.includes(planet.id)
                              || game.currentStage >= planet.unlockStage;
                const drawR = Math.max(planet.radius * scale, planet.isSun ? 32 : 8);
                let x, y;
                if (planet.isSun) {
                    x = centerX; y = centerY;
                } else {
                    const rad = planet.angle * Math.PI / 180;
                    x = centerX + Math.cos(rad) * planet.distance * scale;
                    y = centerY + Math.sin(rad)  * planet.distance * scale;
                }

                div.style.width  = drawR * 2 + 'px';
                div.style.height = drawR * 2 + 'px';
                div.style.left   = x + 'px';
                div.style.top    = y + 'px';

                // æ ¹æ®ç§‘æŠ€ç­‰çº§è°ƒæ•´æ˜Ÿçƒå…‰æ™•ï¼ˆå¤ªé˜³é™¤å¤–ï¼‰
                if (!planet.isSun && unlocked) {
                    div.style.boxShadow = `0 0 ${glowIntensity}px ${glowColor}, 0 0 ${glowIntensity * 2}px ${glowColor}`;
                }

                if (unlocked && div.classList.contains('locked')) {
                    div.classList.remove('locked');
                    div.classList.add('appearing');
                    setTimeout(() => div.classList.remove('appearing'), 900);
                } else if (!unlocked && !div.classList.contains('locked')) {
                    div.classList.add('locked');
                }

                planet.screenX = x;
                planet.screenY = y;
                planet.drawR   = drawR;
            });
        }

        // å…‰è·¯ç³»ç»Ÿ - æ ¹æ®ç§‘æŠ€ç­‰çº§æ”¹å˜é¢œè‰²å’Œå¼ºåº¦
        function drawEnergyLinks() {
            const earth = planets.find(p => p.id === 'earth');
            
            // æ ¹æ®ç§‘æŠ€ç­‰çº§é€‰æ‹©é¢œè‰²
            const techLevel = game.techLevel || 0;
            const linkColors = [
                ['rgba(251, 191, 36, 0.3)', 'rgba(251, 191, 36, 0.6)', 'rgba(251, 191, 36, 0.3)'],  // Lv0: é‡‘è‰²
                ['rgba(0, 217, 255, 0.4)', 'rgba(0, 217, 255, 0.7)', 'rgba(0, 217, 255, 0.4)'],      // Lv1: é’è‰²
                ['rgba(168, 85, 247, 0.5)', 'rgba(168, 85, 247, 0.8)', 'rgba(168, 85, 247, 0.5)'],   // Lv2: ç´«è‰²
                ['rgba(255, 0, 255, 0.5)', 'rgba(255, 0, 255, 0.9)', 'rgba(255, 0, 255, 0.5)'],      // Lv3: å“çº¢
                ['rgba(255, 255, 255, 0.6)', 'rgba(255, 255, 255, 1.0)', 'rgba(255, 255, 255, 0.6)'] // Lv4: ç™½è‰²
            ];
            const colors = linkColors[Math.min(techLevel, 4)];
            const lineWidth = 2 + techLevel * 0.8;
            const shadowBlur = 10 + techLevel * 8;
            
            game.unlockedPlanets.forEach(planetId => {
                if (planetId === 'earth' || planetId === 'sun') return;
                
                const planet = planets.find(p => p.id === planetId);
                if (!planet || !planet.screenX) return;

                // ç»˜åˆ¶å…‰è·¯
                const gradient = ctx.createLinearGradient(
                    earth.screenX, earth.screenY,
                    planet.screenX, planet.screenY
                );
                gradient.addColorStop(0, colors[0]);
                gradient.addColorStop(0.5, colors[1]);
                gradient.addColorStop(1, colors[2]);

                ctx.strokeStyle = gradient;
                ctx.lineWidth = lineWidth;
                // ç§»é™¤é˜´å½±æ•ˆæœä»¥æå‡æ€§èƒ½
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(earth.screenX, earth.screenY);
                ctx.lineTo(planet.screenX, planet.screenY);
                ctx.stroke();
                ctx.setLineDash([]);
            });
        }

        // ç²’å­ç³»ç»Ÿ - æ ¹æ®ç§‘æŠ€ç­‰çº§æ”¹å˜é¢œè‰²å’Œæ•°é‡
        function createParticle(x, y, targetX, targetY) {
            // é™åˆ¶ç²’å­æ€»æ•°ï¼Œé¿å…æ€§èƒ½é—®é¢˜
            if (particles.length > 100) return;
            
            const techLevel = game.techLevel || 0;
            const particleCount = 1 + Math.floor(techLevel * 0.3);  // å‡å°‘ç²’å­æ•°é‡
            
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x, y, targetX, targetY,
                    vx: (targetX - x) / 50,
                    vy: (targetY - y) / 50,
                    life: 50,
                    maxLife: 50,
                    techLevel: techLevel
                });
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;

                const alpha = p.life / p.maxLife;
                // æ ¹æ®ç§‘æŠ€ç­‰çº§æ”¹å˜ç²’å­é¢œè‰²
                const colorValues = [
                    [251, 191, 36],   // é‡‘è‰²
                    [0, 217, 255],    // é’è‰²
                    [168, 85, 247],   // ç´«è‰²
                    [255, 0, 255],    // å“çº¢
                    [255, 255, 255]   // ç™½è‰²
                ];
                const rgb = colorValues[Math.min(p.techLevel || 0, 4)];
                const color = `rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, ${alpha})`;
                
                ctx.fillStyle = color;
                // ç§»é™¤é˜´å½±æ•ˆæœä»¥æå‡æ€§èƒ½
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3 + (p.techLevel || 0) * 0.5, 0, Math.PI * 2);
                ctx.fill();

                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        // ç‚¹å‡»æ£€æµ‹
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;

            // ä»æœ€å¤–å±‚è¡Œæ˜Ÿå¾€å†…éå†ï¼Œä¼˜å…ˆå‘½ä¸­å¤–å±‚
            [...planets].reverse().forEach(planet => {
                if (planet.id === 'sun') return;
                if (!planet.screenX) return;

                const unlocked = game.unlockedPlanets.includes(planet.id) || game.currentStage >= planet.unlockStage;
                if (!unlocked) return;

                const dx = clickX - planet.screenX;
                const dy = clickY - planet.screenY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                // ç‚¹å‡»åŒºåŸŸç•¥å¤§äºè§†è§‰åŠå¾„ï¼Œæ‰‹æœºç«¯æ›´æ˜“ç‚¹ä¸­
                const hitRadius = (planet.drawR || planet.radius * scale) + 12;

                if (dist <= hitRadius) {
                    handlePlanetClick(planet, e.clientX, e.clientY);
                }
            });
        });

        function handlePlanetClick(planet, clientX, clientY) {
            const earned = game.clickPower * (planet.clickMulti || 1);
            game.ore += earned;  // ç‚¹å‡»è·å¾—çŸ¿çŸ³
            game.totalEarned += earned;
            game.totalClicks++;

            // æµ®åŠ¨æ•°å­—
            const floatingNum = document.createElement('div');
            floatingNum.className = 'floating-number';
            floatingNum.textContent = '+' + formatNumber(earned) + ' ğŸ’';
            floatingNum.style.left = clientX + 'px';
            floatingNum.style.top = clientY + 'px';
            document.body.appendChild(floatingNum);
            setTimeout(() => floatingNum.remove(), 1500);

            // ç²’å­æ•ˆæœ
            if (planet.id !== 'earth') {
                const earth = planets.find(p => p.id === 'earth');
                const particleCount = 3 + Math.floor(game.techLevel * 0.5);
                for (let i = 0; i < particleCount; i++) {
                    setTimeout(() => {
                        createParticle(planet.screenX, planet.screenY, earth.screenX, earth.screenY);
                    }, i * 100);
                }
            }

            updateUI();
            checkStageProgress();
        }

        // æ•°å­—æ ¼å¼åŒ–
        function formatNumber(num) {
            if (num < 1000) return Math.floor(num);
            if (num < 1000000) return (num / 1000).toFixed(1) + 'K';
            if (num < 1000000000) return (num / 1000000).toFixed(2) + 'M';
            return (num / 1000000000).toFixed(2) + 'B';
        }

        // åˆå§‹åŒ–å‡çº§
        function initUpgrades() {
            for (let category in upgradesConfig) {
                upgradesConfig[category].forEach(config => {
                    const item = { ...config, level: 0 };
                    if (category === 'tech') {
                        item.unlocked = false;  // ç§‘æŠ€éœ€è¦è§£é”
                    }
                    game.upgrades[category].push(item);
                });
            }
        }

        // æ¸²æŸ“å‡çº§
        function renderUpgrades() {
            for (let category in game.upgrades) {
                const container = document.getElementById(category + 'Grid');
                if (!container) continue;
                container.innerHTML = '';

                game.upgrades[category].forEach((upgrade, index) => {
                    // ç§‘æŠ€ç³»ç»Ÿç‰¹æ®Šå¤„ç†
                    if (category === 'tech') {
                        const canAfford = game.energy >= upgrade.baseCost;
                        const isLocked = index > 0 && !game.upgrades.tech[index - 1].unlocked;
                        const alreadyUnlocked = upgrade.unlocked;

                        const card = document.createElement('div');
                        card.className = `upgrade-card ${alreadyUnlocked ? 'disabled' : canAfford && !isLocked ? '' : 'disabled'}`;
                        card.innerHTML = `
                            <div class="upgrade-card-header">
                                <span class="upgrade-name">${upgrade.icon} ${upgrade.name}</span>
                                <span class="upgrade-level-badge">${alreadyUnlocked ? 'âœ“ å·²è§£é”' : isLocked ? 'ğŸ”’ é”å®š' : 'æœªè§£é”'}</span>
                            </div>
                            <div style="font-size:0.75rem;color:#94a3b8;margin:0.5rem 0;line-height:1.4;">${upgrade.desc}</div>
                            <div class="upgrade-stats">
                                <span class="upgrade-cost-label">âš¡ ${formatNumber(upgrade.baseCost)} èƒ½æº</span>
                                <span style="color:#a855f7;font-size:0.75rem;">Lv.${upgrade.techLevel}</span>
                            </div>
                            ${isLocked ? '<div style="font-size:0.7rem;color:#f59e0b;margin-top:0.3rem;">éœ€è¦å‰ç½®ç§‘æŠ€</div>' : ''}
                        `;

                        if (!alreadyUnlocked && !isLocked) {
                            card.onclick = () => buyTech(upgrade);
                        }
                        container.appendChild(card);
                    } else {
                        // æ™®é€šå‡çº§
                        const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMult || 1.12, upgrade.level));
                        const costType = upgrade.costType || 'ore';
                        const canAfford = costType === 'ore' ? game.ore >= cost : game.energy >= cost;
                        const production = upgrade.baseProduction * upgrade.level;

                        let costIcon = costType === 'ore' ? 'ğŸ’' : 'âš¡';
                        let costName = costType === 'ore' ? 'çŸ¿çŸ³' : 'èƒ½æº';
                        
                        let prodText = '';
                        if (upgrade.outputType === 'ore') {
                            prodText = production > 0 ? `ğŸ’ +${formatNumber(production)}/ç§’` : '';
                        } else if (upgrade.outputType === 'energy') {
                            prodText = production > 0 ? `âš¡ +${formatNumber(production)}/ç§’` : '';
                        } else if (upgrade.bonus === 'click') {
                            prodText = `ç‚¹å‡» +${upgrade.baseProduction * upgrade.level}`;
                        } else if (upgrade.bonus === 'energyBoost') {
                            prodText = upgrade.level > 0 ? `èƒ½æº Ã—${upgrade.boostValue}` : '';
                        } else if (upgrade.bonus === 'speed') {
                            prodText = upgrade.level > 0 ? `é€Ÿåº¦ Ã—${upgrade.speedMult}` : '';
                        }

                        const card = document.createElement('div');
                        card.className = `upgrade-card ${canAfford ? '' : 'disabled'}`;
                        card.innerHTML = `
                            <div class="upgrade-card-header">
                                <span class="upgrade-name">${upgrade.icon} ${upgrade.name}</span>
                                <span class="upgrade-level-badge">Lv.${upgrade.level}</span>
                            </div>
                            <div class="upgrade-stats">
                                <span class="upgrade-cost-label">${costIcon} ${formatNumber(cost)} ${costName}</span>
                                <span class="upgrade-prod-label">${prodText}</span>
                            </div>
                        `;

                        card.onclick = () => buyUpgrade(upgrade);
                        container.appendChild(card);
                    }
                });
            }
        }

        // è´­ä¹°å‡çº§
        function buyUpgrade(upgrade) {
            const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMult || 1.12, upgrade.level));
            const costType = upgrade.costType || 'ore';
            
            const canAfford = costType === 'ore' ? game.ore >= cost : game.energy >= cost;
            
            if (canAfford) {
                if (costType === 'ore') {
                    game.ore -= cost;
                } else {
                    game.energy -= cost;
                }
                
                upgrade.level++;
                
                if (upgrade.bonus === 'click') {
                    game.clickPower += upgrade.baseProduction;
                }

                updateProduction();
                renderUpgrades();
                updateUI();
            }
        }

        // è´­ä¹°ç§‘æŠ€
        function buyTech(tech) {
            if (game.energy >= tech.baseCost && !tech.unlocked) {
                game.energy -= tech.baseCost;
                tech.unlocked = true;
                game.techLevel = tech.techLevel;
                
                // æ›´æ–°æ–‡æ˜ç­‰çº§æ˜¾ç¤º
                const techNames = ['ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', 'ğŸŒ™ åœ°æœˆæ–‡æ˜', 'â˜€ï¸ å¤ªé˜³ç³»æ–‡æ˜', 'âš« é»‘æ´æ–‡æ˜', 'ğŸŒŒ é“¶æ²³æ–‡æ˜'];
                document.getElementById('civLevel').textContent = techNames[game.techLevel];
                
                // æ˜¾ç¤ºé€šçŸ¥
                showTechUnlocked(tech);
                
                updateProduction();
                renderUpgrades();
                updateUI();
            }
        }

        // æ˜¾ç¤ºç§‘æŠ€è§£é”é€šçŸ¥
        function showTechUnlocked(tech) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(15, 23, 42, 0.98);
                padding: 2rem 2.5rem;
                border-radius: 20px;
                border: 2px solid var(--accent-cyan);
                max-width: 500px;
                z-index: 9999;
                backdrop-filter: blur(15px);
                box-shadow: 0 0 60px rgba(0, 217, 255, 0.4);
                text-align: center;
            `;
            modal.innerHTML = `
                <div style="font-family: var(--font-ui); font-size: 1.8rem; font-weight: 700; color: var(--accent-cyan); margin-bottom: 1rem;">
                    ${tech.icon} ${tech.name}
                </div>
                <div style="color: #cbd5e1; margin-bottom: 1.5rem; line-height: 1.6;">
                    ${tech.desc}
                </div>
                <button onclick="this.parentElement.remove()" style="
                    width: 100%;
                    background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
                    border: none;
                    padding: 0.8rem;
                    border-radius: 10px;
                    color: white;
                    font-size: 1rem;
                    font-weight: 700;
                    cursor: pointer;
                    font-family: var(--font-ui);
                ">ç»§ç»­æ¢ç´¢ â†’</button>
            `;
            document.body.appendChild(modal);
        }

        // æ›´æ–°äº§é‡
        function updateProduction() {
            game.orePerSec = 0;
            game.energyPerSec = 0;
            game.techPerSec = 0;

            // 1. è®¡ç®—çŸ¿çŸ³äº§é‡ï¼ˆé‡‡çŸ¿å·¥å‚ï¼‰
            game.upgrades.mining.forEach(upgrade => {
                if (upgrade.outputType === 'ore') {
                    game.orePerSec += upgrade.baseProduction * upgrade.level;
                }
            });

            // 2. è®¡ç®—èƒ½æºäº§é‡ï¼ˆèƒ½æºè®¾æ–½ï¼‰
            game.upgrades.energy.forEach(upgrade => {
                if (upgrade.outputType === 'energy') {
                    game.energyPerSec += upgrade.baseProduction * upgrade.level;
                }
            });

            // 3. ç§‘æŠ€äº§é‡ï¼ˆåŸºäºèƒ½æºå’Œç§‘æŠ€ç­‰çº§ï¼‰
            game.techPerSec = game.energyPerSec * 0.01 * (1 + game.techLevel * 0.5);

            // 4. ç‰¹æ®Šå»ºç­‘åŠ æˆ
            const dysonLevel = game.upgrades.special.find(u => u.id === 'sp2')?.level || 0;
            if (dysonLevel > 0) {
                const boost = game.upgrades.special.find(u => u.id === 'sp2')?.boostValue || 1;
                game.energyPerSec *= boost;
            }

            const acceleratorLevel = game.upgrades.special.find(u => u.id === 'sp3')?.level || 0;
            if (acceleratorLevel > 0) {
                const speedMult = game.upgrades.special.find(u => u.id === 'sp3')?.speedMult || 1;
                game.orePerSec *= speedMult;
                game.energyPerSec *= speedMult;
                game.techPerSec *= speedMult;
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('oreVal').textContent = formatNumber(game.ore);
            document.getElementById('energyVal').textContent = formatNumber(game.energy);
            document.getElementById('techVal').textContent = formatNumber(game.tech);
            document.getElementById('oreRate').textContent = '+' + formatNumber(game.orePerSec) + '/ç§’';
            document.getElementById('energyRate').textContent = '+' + formatNumber(game.energyPerSec) + '/ç§’';
            document.getElementById('techRate').textContent = '+' + formatNumber(game.techPerSec) + '/ç§’';
        }

        // æ£€æŸ¥é˜¶æ®µè¿›åº¦
        function checkStageProgress() {
            const currentStage = stages[game.currentStage];
            const nextStage = stages[game.currentStage + 1];

            if (nextStage && game.totalEarned >= nextStage.threshold) {
                advanceStage(nextStage);
            }

            if (nextStage) {
                const progress = ((game.totalEarned - currentStage.threshold) / 
                                 (nextStage.threshold - currentStage.threshold)) * 100;
                
                document.getElementById('progressBar').style.width = Math.min(progress, 100) + '%';
                document.getElementById('progressPercent').textContent = 
                    `${Math.floor(Math.min(progress, 100))}% (${formatNumber(game.totalEarned)} / ${formatNumber(nextStage.threshold)})`;
                document.getElementById('progressTitle').textContent = 'ğŸ¯ è·ç¦»' + nextStage.name;
            } else {
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercent').textContent = '100% - æ–‡æ˜å·…å³°';
                document.getElementById('progressTitle').textContent = 'ğŸ‰ æ–‡æ˜å·…å³°';
            }
        }

        // æ¨è¿›é˜¶æ®µ
        function advanceStage(stage) {
            game.currentStage = stage.id;
            document.getElementById('civLevel').textContent = stage.name;

            // è§£é”è¡Œæ˜Ÿ
            planets.forEach(planet => {
                if (planet.unlockStage === stage.id && planet.id !== 'sun') {
                    game.unlockedPlanets.push(planet.id);
                }
            });

            showMilestone(stage);
        }

        // æ˜¾ç¤ºé‡Œç¨‹ç¢‘
        function showMilestone(stage) {
            const modal = document.createElement('div');
            modal.className = 'milestone-overlay';
            modal.innerHTML = `
                <div class="milestone-box">
                    <div class="milestone-emoji">ğŸ‰</div>
                    <div class="milestone-heading">${stage.name}</div>
                    <div class="milestone-description">${stage.desc}</div>
                    <button class="milestone-cta">ç»§ç»­æ¢ç´¢å®‡å®™</button>
                </div>
            `;

            document.body.appendChild(modal);
            modal.querySelector('button').onclick = () => modal.remove();
        }

        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
            });
        });

        // æ¸¸æˆå¾ªç¯
        setInterval(() => {
            game.ore += game.orePerSec / 5;
            game.energy += game.energyPerSec / 5;
            game.tech += game.techPerSec / 5;
            game.totalEarned += game.orePerSec / 5;
            
            updateUI();
            checkStageProgress();
        }, 200);

        // æ¸²æŸ“å¾ªç¯ - é™åˆ¶å¸§ç‡åˆ°30FPSä»¥é™ä½CPUå ç”¨
        let lastFrameTime = 0;
        function gameLoop(timestamp) {
            // é™åˆ¶åˆ°30FPS (çº¦33msä¸€å¸§)
            if (timestamp - lastFrameTime >= 33) {
                drawSolarSystem();
                lastFrameTime = timestamp;
            }
            requestAnimationFrame(gameLoop);
        }

        // è‡ªåŠ¨ä¿å­˜ï¼ˆåªåœ¨é€‰æ‹©å›½å®¶åæ‰ä¿å­˜ï¼‰
        setInterval(() => {
            if (game.country) {  // åªæœ‰é€‰æ‹©äº†å›½å®¶æ‰ä¿å­˜
                game.lastSaveTime = Date.now();
                localStorage.setItem('spaceEmpireV5', JSON.stringify(game));
            }
        }, 5000);

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saved = localStorage.getItem('spaceEmpireV5');
            if (!saved) return false;

            const savedGame = JSON.parse(saved);
            Object.assign(game, savedGame);

            const offlineTime = (Date.now() - game.lastSaveTime) / 1000;
            if (offlineTime > 60) {
                const offlineOre = game.orePerSec * Math.min(offlineTime, 3600 * 4);
                const offlineEnergy = game.energyPerSec * Math.min(offlineTime, 3600 * 4);
                const offlineTech = game.techPerSec * Math.min(offlineTime, 3600 * 4);
                
                showOfflineEarnings(offlineOre, offlineEnergy, offlineTech, offlineTime);
                game.ore += offlineOre;
                game.energy += offlineEnergy;
                game.tech += offlineTech;
            }

            const techNames = ['ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', 'ğŸŒ™ åœ°æœˆæ–‡æ˜', 'â˜€ï¸ å¤ªé˜³ç³»æ–‡æ˜', 'âš« é»‘æ´æ–‡æ˜', 'ğŸŒŒ é“¶æ²³æ–‡æ˜'];
            document.getElementById('civLevel').textContent = techNames[game.techLevel] || techNames[0];
            updateProduction();
            return true;
        }

        function showOfflineEarnings(ore, energy, tech, time) {
            const hours = Math.floor(time / 3600);
            const minutes = Math.floor((time % 3600) / 60);

            const modal = document.createElement('div');
            modal.className = 'offline-modal';
            modal.innerHTML = `
                <div class="offline-box">
                    <div class="offline-title">æ¬¢è¿å›æ¥ï¼</div>
                    <div>ç¦»çº¿æ—¶é—´: ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ</div>
                    <div class="offline-amount">ğŸ’ +${formatNumber(ore)}</div>
                    <div class="offline-amount" style="font-size:2rem;margin:0.5rem 0;">âš¡ +${formatNumber(energy)}</div>
                    <div class="offline-amount" style="font-size:1.5rem;margin:0.5rem 0;">ğŸ”¬ +${formatNumber(tech)}</div>
                    <div style="margin-bottom: 1.5rem;">èµ„æºå·²è‡ªåŠ¨æ”¶é›†</div>
                    <button class="offline-btn">å¤ªæ£’äº†ï¼</button>
                </div>
            `;

            document.body.appendChild(modal);
            modal.querySelector('button').onclick = () => {
                modal.remove();
                updateUI();
            };
        }

        // ===== å›½å®¶é…ç½® =====
        const countryConfigs = {
            usa:     { name: 'ç¾å›½',   flag: 'ğŸ‡ºğŸ‡¸', ore: 500,  energy: 50,  clickPower: 100  },
            china:   { name: 'ä¸­å›½',   flag: 'ğŸ‡¨ğŸ‡³', ore: 300,  energy: 80,  clickPower: 100  },
            russia:  { name: 'ä¿„ç½—æ–¯', flag: 'ğŸ‡·ğŸ‡º', ore: 400,  energy: 60,  clickPower: 100  },
            germany: { name: 'å¾·å›½',   flag: 'ğŸ‡©ğŸ‡ª', ore: 250,  energy: 70,  clickPower: 100  },
            india:   { name: 'å°åº¦',   flag: 'ğŸ‡®ğŸ‡³', ore: 200,  energy: 50,  clickPower: 150  }
        };

        function selectCountry(id) {
            const cfg = countryConfigs[id];
            game.ore = cfg.ore;
            game.energy = cfg.energy;
            game.totalEarned = cfg.ore;
            game.clickPower = cfg.clickPower;
            game.country = id;
            game.countryName = cfg.name;

            // æ·¡å‡ºé€‰å›½ç•Œé¢ï¼Œæ·¡å…¥æ¸¸æˆ
            const screen = document.getElementById('countryScreen');
            screen.style.transition = 'opacity 0.8s ease';
            screen.style.opacity = '0';
            setTimeout(() => screen.remove(), 800);

            updateUI();
            checkStageProgress();
        }

        function resetGame() {
            if (!confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¼šä¸¢å¤±ï¼')) {
                return;
            }
            // è®¾ç½®é‡ç½®æ ‡å¿—ï¼Œç„¶åæ¸…é™¤å­˜æ¡£
            sessionStorage.setItem('resetFlag', 'true');
            localStorage.removeItem('spaceEmpireV5');
            location.reload(true);  // å¼ºåˆ¶ä»æœåŠ¡å™¨é‡æ–°åŠ è½½
        }

        // é¢œè‰²å·¥å…·å‡½æ•°
        function lightenColor(hex, amount) {
            const num = parseInt(hex.replace('#',''), 16);
            const r = Math.min(255, (num >> 16) + amount);
            const g = Math.min(255, ((num >> 8) & 0xFF) + amount);
            const b = Math.min(255, (num & 0xFF) + amount);
            return `rgb(${r},${g},${b})`;
        }
        function darkenColor(hex, amount) {
            const num = parseInt(hex.replace('#',''), 16);
            const r = Math.max(0, (num >> 16) - amount);
            const g = Math.max(0, ((num >> 8) & 0xFF) - amount);
            const b = Math.max(0, (num & 0xFF) - amount);
            return `rgb(${r},${g},${b})`;
        }

        // åˆå§‹åŒ–
        window.addEventListener('resize', () => { resizeCanvas(); });
        resizeCanvas();
        initStarfield();
        initPlanetDivs();   // åˆ›å»ºCSSè¡Œæ˜Ÿdiv
        initUpgrades();

        // æ£€æŸ¥æ˜¯å¦æ˜¯é‡ç½®æ“ä½œ
        const isReset = sessionStorage.getItem('resetFlag');
        if (isReset) {
            sessionStorage.removeItem('resetFlag');
            // é‡ç½®æ—¶ç¡®ä¿é€‰å›½ç•Œé¢æ˜¾ç¤º
            const countryScreen = document.getElementById('countryScreen');
            if (countryScreen) {
                countryScreen.style.display = 'flex';
                countryScreen.style.opacity = '1';
            }
        } else {
            // æ­£å¸¸åŠ è½½ï¼šæœ‰å­˜æ¡£ç›´æ¥è¿›æ¸¸æˆï¼Œæ²¡æœ‰å­˜æ¡£æ˜¾ç¤ºé€‰å›½ç•Œé¢
            const hasSave = loadGame();
            if (hasSave) {
                const countryScreen = document.getElementById('countryScreen');
                if (countryScreen) {
                    countryScreen.remove();
                }
            }
        }

        renderUpgrades();
        updateUI();
        checkStageProgress();
        gameLoop();

        window.addEventListener('beforeunload', () => {
            if (game.country) {  // åªæœ‰é€‰æ‹©äº†å›½å®¶æ‰ä¿å­˜
                localStorage.setItem('spaceEmpireV5', JSON.stringify(game));
            }
        });
    </script>
</body>
</html>
