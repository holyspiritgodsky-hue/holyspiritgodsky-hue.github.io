<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªç©ºå¸å›½ - å¾æœå¤ªé˜³ç³»</title>
    <style>
        :root {
            --font-ui:    'Courier New', Consolas, 'SF Mono', monospace;
            --font-body:  -apple-system, 'PingFang SC', 'Microsoft YaHei', 'Hiragino Sans GB', sans-serif;
            --font-mono:  'Courier New', Consolas, monospace;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e1a;
            --bg-panel: rgba(15, 23, 42, 0.92);
            --accent-cyan: #00d9ff;
            --accent-purple: #a855f7;
            --accent-gold: #fbbf24;
            --accent-green: #10b981;
            --text-white: #ffffff;
            --text-gray: #94a3b8;
        }

        body {
            font-family: var(--font-body);
            background: #000;
            color: var(--text-white);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* å®‡å®™ç”»å¸ƒ */
        .universe-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #0a0e1a 0%, #000 100%);
        }

        #universeCanvas {
            width: 100%;
            height: 100%;
        }

        /* UIå±‚ */
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-overlay > * {
            pointer-events: auto;
        }

        /* é¡¶éƒ¨æ  */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 1.5rem 2rem;
            background: linear-gradient(to bottom, rgba(10, 14, 26, 0.95), transparent);
            backdrop-filter: blur(10px);
        }

        .civilization-level {
            text-align: center;
            font-family: var(--font-ui);
            font-size: 1.1rem;
            color: var(--accent-gold);
            margin-bottom: 1rem;
        }

        .resources-compact {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .resource-compact {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid rgba(0, 217, 255, 0.3);
        }

        .resource-icon-small {
            font-size: 1.5rem;
        }

        .resource-value-small {
            font-family: var(--font-mono);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .resource-rate-small {
            font-size: 0.8rem;
            color: var(--accent-green);
        }

        .home-btn {
            padding: 0.5rem 1rem;
            background: rgba(59, 130, 246, 0.15);
            border: 1.5px solid rgba(59, 130, 246, 0.4);
            border-radius: 8px;
            color: #3b82f6;
            font-family: var(--font-ui);
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            text-decoration: none;
            display: inline-block;
        }

        .home-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.7);
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .reset-btn {
            padding: 0.5rem 1rem;
            background: rgba(220, 38, 38, 0.15);
            border: 1.5px solid rgba(220, 38, 38, 0.4);
            border-radius: 8px;
            color: #ef4444;
            font-family: var(--font-ui);
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .reset-btn:hover {
            background: rgba(220, 38, 38, 0.3);
            border-color: rgba(220, 38, 38, 0.7);
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
        }

        .bottom-actions {
            display: flex;
            justify-content: center;
            gap: 0.8rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* åº•éƒ¨æ§åˆ¶é¢æ¿ */
        .bottom-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(10, 14, 26, 0.95), transparent);
            backdrop-filter: blur(15px);
            padding: 1.5rem 2rem;
            max-height: 40vh;
            overflow-y: auto;
        }

        .panel-tabs {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .tab-button {
            font-family: var(--font-ui);
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-gray);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .tab-button.active {
            background: rgba(0, 217, 255, 0.2);
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }

        .tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .upgrades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .upgrade-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade-card:hover:not(.disabled) {
            background: rgba(0, 217, 255, 0.1);
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
        }

        .upgrade-card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .upgrade-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .upgrade-name {
            font-weight: 700;
            font-size: 1rem;
        }

        .upgrade-level-badge {
            background: var(--accent-purple);
            padding: 0.2rem 0.5rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .upgrade-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
        }

        .upgrade-cost-label {
            color: var(--accent-gold);
            font-family: var(--font-mono);
            font-weight: 700;
        }

        .upgrade-prod-label {
            color: var(--accent-green);
        }

        /* è¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-panel);
            padding: 1.5rem 2rem;
            border-radius: 15px;
            border: 2px solid var(--accent-gold);
            text-align: center;
            min-width: 350px;
            pointer-events: none;
        }

        .progress-title-main {
            font-family: var(--font-ui);
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-gold);
            margin-bottom: 0.8rem;
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 0.5rem;
        }

        .progress-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple), var(--accent-gold));
            border-radius: 10px;
            transition: width 0.5s ease;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.6);
        }

        .progress-percentage-text {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        /* é¡¶éƒ¨è¿›åº¦æ¡ */
        .top-progress-bar {
            position: absolute;
            bottom: 268px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15,23,42,0.75);
            padding: 0.5rem 1.2rem;
            border-radius: 20px;
            border: 1px solid rgba(251,191,36,0.35);
            min-width: 300px;
            max-width: 500px;
            width: 50%;
            backdrop-filter: blur(8px);
            pointer-events: none;
        }

        /* æç¤ºæ–‡æœ¬ */
        .hint-text {
            position: absolute;
            bottom: 45%;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-gray);
            font-size: 1rem;
            text-align: center;
            pointer-events: none;
            opacity: 0.8;
            animation: hintPulse 2s ease-in-out infinite;
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* é‡Œç¨‹ç¢‘å¼¹çª— */
        .milestone-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }

        .milestone-box {
            background: var(--bg-panel);
            border: 3px solid var(--accent-gold);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            max-width: 600px;
            animation: milestoneZoom 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 0 80px rgba(251, 191, 36, 0.6);
        }

        @keyframes milestoneZoom {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .milestone-emoji {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: emojiFloat 0.6s ease infinite;
        }

        @keyframes emojiFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .milestone-heading {
            font-family: var(--font-ui);
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .milestone-description {
            font-size: 1.2rem;
            color: var(--text-gray);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .milestone-cta {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            padding: 1rem 3rem;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            font-family: var(--font-ui);
            transition: all 0.3s ease;
        }

        .milestone-cta:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.6);
        }

        /* æµ®åŠ¨æ•°å­— */
        .floating-number {
            position: fixed;
            font-family: var(--font-mono);
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-gold);
            pointer-events: none;
            animation: floatUpAnim 1.5s ease-out forwards;
            text-shadow: 0 0 10px var(--accent-gold);
            z-index: 500;
        }

        @keyframes floatUpAnim {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        /* ç¦»çº¿æ”¶ç›Š */
        .offline-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            animation: fadeIn 0.5s ease;
        }

        .offline-box {
            background: var(--bg-panel);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 60px rgba(0, 217, 255, 0.4);
            max-width: 500px;
        }

        .offline-title {
            font-family: var(--font-ui);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--accent-cyan);
        }

        .offline-amount {
            font-family: var(--font-mono);
            font-size: 3rem;
            font-weight: 900;
            color: var(--accent-gold);
            margin: 1.5rem 0;
            text-shadow: 0 0 30px var(--accent-gold);
        }

        .offline-btn {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border: none;
            padding: 1rem 3rem;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: var(--font-ui);
        }

        .offline-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.4);
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .civilization-level {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .top-bar {
                padding: 1rem 1rem;
            }

            .home-btn, .reset-btn {
                padding: 0.4rem 0.7rem;
                font-size: 0.65rem;
            }

            .resources-compact {
                gap: 0.8rem;
            }

            .resource-compact {
                padding: 0.3rem 0.6rem;
            }

            .resource-icon-small {
                font-size: 1.2rem;
            }

            .resource-value-small {
                font-size: 1rem;
            }

            .resource-rate-small {
                font-size: 0.7rem;
            }

            .bottom-panel {
                max-height: 28vh;
                padding: 0.6rem 0.8rem;
            }

            .panel-tabs {
                margin-bottom: 0.8rem;
            }

            .tab-button {
                padding: 0.4rem 0.6rem;
                font-size: 0.7rem;
            }

            .upgrades-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }

            .upgrade-card {
                padding: 0.8rem;
            }

            .progress-indicator {
                min-width: 260px;
                padding: 0.8rem 1rem;
                bottom: 32vh;
            }

            /* å›½å®¶é€‰æ‹©ç•Œé¢ä¼˜åŒ– */
            .country-screen {
                padding: 0.8rem 0.8rem 0.8rem 0.8rem;
                justify-content: flex-start;
                padding-top: 1.5rem;
            }

            .country-screen-title {
                font-size: 1.4rem;
                margin-bottom: 0.2rem;
            }

            .country-screen-subtitle {
                font-size: 0.75rem;
                margin-bottom: 0.6rem;
            }

            .country-grid {
                gap: 0.5rem;
                grid-template-columns: 1fr;
                max-width: 100%;
            }

            .country-card {
                padding: 0.8rem;
                min-height: 130px;
            }

            .country-flag {
                font-size: 1.5rem;
                margin-bottom: 0.3rem;
            }

            .country-name {
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
            }

            .country-stats {
                font-size: 0.7rem;
                line-height: 1.4;
            }

            .country-tag {
                font-size: 0.6rem;
                padding: 0.1rem 0.4rem;
                margin-top: 0.4rem;
            }

            /* é¡¶éƒ¨è¿›åº¦æ¡ç§»åŠ¨ç«¯ä½ç½® */
            .top-progress-bar {
                bottom: calc(28vh + 10px);
                width: 80%;
                min-width: 260px;
                padding: 0.4rem 0.8rem;
                font-size: 0.7rem;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ===== SVGå¤ªé˜³ç³»åŠ¨ç”»å±‚ï¼ˆå·²è¢« canvas æ¥ç®¡ï¼Œéšè—æ­¤å±‚ï¼‰===== */
        #solarSystemOverlay {
            display: none !important;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 5;
            opacity: 1.0;
            transition: opacity 1.5s ease, filter 1.5s ease, transform 0.3s ease;
            perspective: 2000px;
            perspective-origin: center center;
            transform: rotateX(45deg) scale(0.6);  /* 45åº¦å€¾æ–œ */
            transform-style: preserve-3d;
        }
        
        #solarSystemSVG {
            width: 100%;
            height: 100%;
        }

        /* SVGå¤ªé˜³ç³»åŠ¨ç”»æ ·å¼ */
        .solar-orbit {
            fill: none;
            stroke: rgba(230, 230, 230, 0.3);
            stroke-width: 3;
        }
        
        .solar-sun {
            fill: url(#sun);
            filter: drop-shadow(0 0 50px orange);
        }
        
        .solar-planet {
            transform-origin: center;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
        }
        
        .solar-shadow {
            fill: url(#shadow);
        }
        

        
        /* æ ¹æ®ç§‘æŠ€ç­‰çº§è°ƒæ•´è§†è§’ï¼šä»åœ°çƒç‰¹å†™é€æ¸æ‹‰è¿œåˆ°å®Œæ•´å¤ªé˜³ç³» */
        #solarSystemOverlay.tech-level-0 {
            filter: brightness(1.0) saturate(0.9);
        }
        
        #solarSystemOverlay.tech-level-1 {
            filter: brightness(1.0) saturate(1.0) hue-rotate(5deg);
        }
        
        #solarSystemOverlay.tech-level-2 {
            filter: brightness(1.0) saturate(1.1) hue-rotate(10deg);
        }

        #solarSystemOverlay.tech-level-3 {
            filter: brightness(1.0) saturate(1.3) hue-rotate(15deg);
        }

        #solarSystemOverlay.tech-level-4 {
            filter: brightness(1.0) saturate(1.5) hue-rotate(20deg);
        }
        
        /* Lv4æ‰«æçº¿ç‰¹æ•ˆ */
        #solarSystemOverlay.tech-level-4::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(147, 112, 219, 0.03) 2px,
                rgba(147, 112, 219, 0.03) 4px
            );
            animation: scanlineMove 8s linear infinite;
            pointer-events: none;
        }
        
        @keyframes scanlineMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(20px); }
        }

        @keyframes nebulaPulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        /* ===== CSSè¡Œæ˜Ÿå±‚ï¼ˆå åœ¨canvasä¸Šæ–¹ï¼Œé¿å¼€è·¨åŸŸé™åˆ¶ï¼‰===== */
        #planetLayer {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;   /* é»˜è®¤ä¸æ‹¦æˆªï¼Œè¡Œæ˜Ÿè‡ªå·±å¼€å¯ */
            z-index: 10;
        }

        .planet-div {
            position: absolute;
            border-radius: 50%;
            background: transparent;
            transform: translate(-50%, -50%);
            cursor: default;
            pointer-events: none;
            transition: filter 0.4s ease, opacity 0.6s ease, box-shadow 0.4s ease;
            border: none;
        }

        .planet-div.locked {
            pointer-events: none;
            opacity: 0;
            border-color: transparent;
        }

        /* ç§»é™¤æ‰€æœ‰å•ç‹¬æ˜Ÿçƒå›¾ç‰‡ï¼Œä½¿ç”¨å¤ªé˜³ç³»å›¾ä¸­çš„è¡Œæ˜Ÿ */
        .p-sun, .p-mercury, .p-venus, .p-earth, .p-moon, .p-mars, 
        .p-jupiter, .p-saturn, .p-uranus, .p-neptune {
            background: transparent;
        }
        
        /* å¤ªé˜³ç‰¹æ®Šå¤„ç†ï¼šæ— è¾¹æ¡†ï¼Œä¸å¯ç‚¹ */
        .p-sun {
            pointer-events: none;
            border: none;
        }

        /* è¡Œæ˜Ÿè‡ªè½¬åŠ¨ç”»å·²ç§»é™¤ - ä¿æŒæ¸…æ™°é™æ€å±•ç¤º */

        /* è§£é”æ—¶çš„å‡ºç°åŠ¨ç”» */
        @keyframes planetAppear {
            0%   { transform: translate(-50%,-50%) scale(0); opacity:0; }
            60%  { transform: translate(-50%,-50%) scale(1.15); }
            100% { transform: translate(-50%,-50%) scale(1);  opacity:1; }
        }
        .planet-div.appearing { animation: planetAppear 0.8s cubic-bezier(0.34,1.56,0.64,1) forwards; }

        /* ===== é€‰å›½å®¶å¼€åœºç•Œé¢ ===== */
        .country-screen {
            position: fixed;
            inset: 0;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 1s ease;
        }

        .country-screen-title {
            font-family: var(--font-ui);
            font-size: 2.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .country-screen-subtitle {
            color: var(--text-gray);
            font-size: 1rem;
            margin-bottom: 2rem;
            text-align: center;
            font-style: italic;
            max-width: 500px;
            line-height: 1.6;
        }

        .country-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 900px;
        }

        .country-card {
            background: rgba(15, 23, 42, 0.85);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 14px;
            padding: 1.4rem 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
            min-height: 260px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .country-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.75), rgba(15,23,42,0.85));
            opacity: 1;
            transition: opacity 0.3s;
            z-index: 1;
        }

        .country-card:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0,217,255,0.25);
        }

        .country-card:hover::before { opacity: 0.7; }

        .country-card.vip {
            border-color: rgba(251,191,36,0.4);
        }

        .country-card.vip:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 10px 30px rgba(251,191,36,0.3);
        }

        .country-flag {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            display: block;
            position: relative;
            z-index: 2;
        }

        .country-name {
            font-family: var(--font-ui);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            color: var(--text-white);
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 8px rgba(0,0,0,0.8);
        }

        .country-stats {
            font-size: 0.82rem;
            color: var(--text-gray);
            line-height: 1.7;
            position: relative;
            z-index: 2;
        }

        .country-stats span {
            display: block;
            text-shadow: 0 1px 4px rgba(0,0,0,0.7);
        }

        .country-stats .highlight {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        .country-tag {
            display: inline-block;
            margin-top: 0.6rem;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.72rem;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .tag-vip { background: rgba(251,191,36,0.2); color: var(--accent-gold); border: 1px solid rgba(251,191,36,0.4); }

        /* å›½å®¶ç‰¹å®šèƒŒæ™¯å›¾ç‰‡ */
        .country-usa { background-image: url('https://flagcdn.com/w640/us.png'); }
        .country-china { background-image: url('https://flagcdn.com/w640/cn.png'); }
        .country-russia { background-image: url('https://flagcdn.com/w640/ru.png'); }
        .country-germany { background-image: url('https://flagcdn.com/w640/de.png'); }
        .country-japan { background-image: url('https://flagcdn.com/w640/jp.png'); }
        .tag-event { background: rgba(168,85,247,0.2); color: var(--accent-purple); border: 1px solid rgba(168,85,247,0.4); }
        .tag-balanced { background: rgba(16,185,129,0.2); color: var(--accent-green); border: 1px solid rgba(16,185,129,0.4); }
    </style>
</head>
<body>
    <!-- å®‡å®™ç”»å¸ƒï¼ˆåªç»˜åˆ¶æ˜Ÿç©ºã€è½¨é“çº¿ã€å…‰è·¯ã€ç²’å­ï¼‰ -->
    <div class="universe-canvas">
        <canvas id="universeCanvas"></canvas>
    </div>

    <!-- SVGå¤ªé˜³ç³»åŠ¨ç”»å±‚ -->
    <div id="solarSystemOverlay" class="solar-overlay">
        <svg id="solarSystemSVG" style="fill-rule:evenodd" viewBox="0 0 25000 25000">
            <defs>
                <radialGradient id="sun">
                    <stop offset="30%" stop-color="yellow"/>
                    <stop offset="100%" stop-color="orange"/>
                </radialGradient>
                <radialGradient id="sunshine">
                    <stop offset="10%" stop-color="orange"/>
                    <stop offset="95%" stop-color="transparent"/>
                </radialGradient>
                <linearGradient id="shadow">
                    <stop offset="0" stop-color="transparent"/>
                    <stop offset="50%" stop-color="#000"/>
                </linearGradient>
                <linearGradient id="mercury-shadow">
                    <stop offset="50%" stop-color="transparent"/>
                    <stop offset="100%" stop-color="rgba(0,0,0,.5)"/>
                </linearGradient>
                <linearGradient id="venus-grad" x1="0" y1="0" x2="0" y2="100%">
                    <stop offset="30%" stop-color="#f0990e"/>
                    <stop offset="40%" stop-color="#fecb36"/>
                    <stop offset="60%" stop-color="#f0990e"/>
                    <stop offset="100%" stop-color="#f0990e"/>
                </linearGradient>
                <radialGradient id="earth-grad" fx="0.2" fy="0.2">
                    <stop offset="50%" stop-color="#009688"/>
                    <stop offset="60%" stop-color="#009688"/>
                    <stop offset="70%" stop-color="#0270e9"/>
                    <stop offset="100%" stop-color="#0270e9"/>
                </radialGradient>
                <radialGradient id="mars-grad" fx="0.3" fy="0.3">
                    <stop offset="60%" stop-color="#e25409"/>
                    <stop offset="65%" stop-color="#e25409"/>
                    <stop offset="100%" stop-color="#BF360C"/>
                </radialGradient>
                <linearGradient id="jupiter-grad" x1="0" y1="0" x2="0" y2="100%">
                    <stop offset="15%" stop-color="#d7b872"/>
                    <stop offset="25%" stop-color="#a24416"/>
                    <stop offset="30%" stop-color="#a24416"/>
                    <stop offset="40%" stop-color="#a6563e"/>
                    <stop offset="60%" stop-color="#a6563e"/>
                    <stop offset="80%" stop-color="#6f3620"/>
                    <stop offset="100%" stop-color="#d7b872"/>
                </linearGradient>
                <linearGradient id="saturn-grad" x1="0" x2="0" y1="0" y2="100%">
                    <stop offset="0%" stop-color="#ec9a22"/>
                    <stop offset="40%" stop-color="#d16c10"/>
                    <stop offset="55%" stop-color="#d16c10"/>
                    <stop offset="50%" stop-color="#ec9925"/>
                    <stop offset="70%" stop-color="#ec9925"/>
                    <stop offset="75%" stop-color="#d07b15"/>
                    <stop offset="100%" stop-color="#ec9a22"/>
                </linearGradient>
                <linearGradient id="uranus-grad" x1="0" y1="0" x2="0" y2="100%">
                    <stop offset="15%" stop-color="#199cdd"/>
                    <stop offset="25%" stop-color="#32b1fd"/>
                    <stop offset="30%" stop-color="#199cdd"/>
                    <stop offset="40%" stop-color="#32b1fd"/>
                    <stop offset="60%" stop-color="#199cdd"/>
                    <stop offset="80%" stop-color="#32b1fd"/>
                    <stop offset="100%" stop-color="#199cdd"/>
                </linearGradient>
                <linearGradient id="neptune-grad" x1="0" y1="0" x2="0" y2="100%">
                    <stop offset="0%" stop-color="#005de8"/>
                    <stop offset="25%" stop-color="#0747a3"/>
                    <stop offset="50%" stop-color="#287af7"/>
                    <stop offset="75%" stop-color="#0747a3"/>
                    <stop offset="100%" stop-color="#005de8"/>
                </linearGradient>
            </defs>
            <g>
                <circle class="solar-orbit" cx="50%" cy="50%" r="12000"/>
                <circle class="solar-orbit" cx="50%" cy="50%" r="10500"/>
                <circle class="solar-orbit" cx="50%" cy="50%" r="8000"/>
                <circle class="solar-orbit" cx="50%" cy="50%" r="5500"/>
                <circle class="solar-orbit" cx="50%" cy="50%" r="4100"/>
                <circle class="solar-orbit" cx="50%" cy="50%" r="3100"/>
                <circle class="solar-orbit" cx="50%" cy="50%" r="2000"/>
                <circle class="solar-orbit" cx="50%" cy="50%" r="1000"/>
                <circle class="solar-sun" cx="50%" cy="50%" r="1600"/>
                
                <g class="neptune-group">
                    <circle class="solar-planet" cx="50%" cy="50%" r="200" fill="url(#neptune-grad)"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="200"/>
                </g>
                <g class="uranus-group">
                    <circle class="solar-planet" cx="50%" cy="50%" r="200" fill="url(#uranus-grad)"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="200"/>
                </g>
                <g class="saturn-group">
                    <circle class="solar-planet" cx="50%" cy="50%" r="1100" fill="none" stroke="#bf4c0d" stroke-width="50"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="1150"/>
                    <circle class="solar-planet" cx="50%" cy="50%" r="850" fill="none" stroke="#bf4c0d" stroke-width="300"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="1000"/>
                    <circle class="solar-planet" cx="50%" cy="50%" r="400" fill="url(#saturn-grad)"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="400"/>
                </g>
                <g class="jupiter-group">
                    <circle class="solar-planet" cx="50%" cy="50%" r="300" fill="url(#jupiter-grad)"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="300"/>
                </g>
                <g class="mars-group">
                    <circle class="solar-planet" cx="50%" cy="50%" r="300" fill="url(#mars-grad)"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="300"/>
                </g>
                <g class="earth-group">
                    <circle class="solar-orbit" cx="50%" cy="50%" r="500"/>
                    <g class="moon-group">
                        <circle class="solar-planet" cx="50%" cy="50%" r="50" fill="#E6E6E6"/>
                        <circle class="solar-shadow" cx="50%" cy="50%" r="50"/>
                    </g>
                    <circle class="solar-planet" cx="50%" cy="50%" r="300" fill="url(#earth-grad)"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="300"/>
                </g>
                <g class="venus-group">
                    <circle class="solar-planet" cx="50%" cy="50%" r="200" fill="url(#venus-grad)"/>
                    <circle class="solar-shadow" cx="50%" cy="50%" r="200"/>
                </g>
                <g class="mercury-group">
                    <circle class="solar-planet" cx="50%" cy="50%" r="100" fill="#be9a60"/>
                    <circle cx="50%" cy="50%" r="100" fill="url(#mercury-shadow)"/>
                </g>
            </g>
        </svg>
    </div>

    <!-- CSSè¡Œæ˜Ÿå±‚ï¼ˆçœŸå®å›¾ç‰‡ï¼Œé¿å¼€Canvasè·¨åŸŸé™åˆ¶ï¼‰ -->
    <div id="planetLayer"></div>

    <!-- é€‰å›½å®¶å¼€åœºç•Œé¢ -->
    <div class="country-screen" id="countryScreen">
        
        <div class="country-screen-subtitle">
            "æˆ‘ä»¬é‡‡çŸ¿ï¼Œæˆ‘ä»¬æœé›†èƒ½æºï¼Œæˆ‘ä»¬å‘å±•ç§‘æŠ€ï¼Œæˆ‘ä»¬è¿ˆå‘é“¶æ²³"
        </div>
        <div class="country-grid">
            <div class="country-card country-usa vip" onclick="selectCountry('usa')">
                <span class="country-flag">ğŸ‡ºğŸ‡¸</span>
                <div class="country-name">ç¾å›½</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">500</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">50</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">60</b></span>
                    <span class="country-tag tag-vip">â˜… VIP ä¼˜åŠ¿</span>
                </div>
            </div>
            <div class="country-card country-china" onclick="selectCountry('china')">
                <span class="country-flag">ğŸ‡¨ğŸ‡³</span>
                <div class="country-name">ä¸­å›½</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">200</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">80</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">80</b></span>
                    <span class="country-tag tag-event">ç‹¬æœ‰äº‹ä»¶é“¾</span>
                </div>
            </div>
            <div class="country-card country-russia" onclick="selectCountry('russia')">
                <span class="country-flag">ğŸ‡·ğŸ‡º</span>
                <div class="country-name">ä¿„ç½—æ–¯</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">400</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">60</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">60</b></span>
                    <span class="country-tag tag-balanced">å‡è¡¡å‘å±•</span>
                </div>
            </div>
            <div class="country-card country-germany" onclick="selectCountry('germany')">
                <span class="country-flag">ğŸ‡©ğŸ‡ª</span>
                <div class="country-name">å¾·å›½</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">250</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">70</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">60</b></span>
                    <span class="country-tag tag-balanced">å·¥ä¸šå¼ºå›½</span>
                </div>
            </div>
            <div class="country-card country-japan" onclick="selectCountry('japan')">
                <span class="country-flag">ğŸ‡¯ğŸ‡µ</span>
                <div class="country-name">æ—¥æœ¬</div>
                <div class="country-stats">
                    <span>ğŸ’ åˆå§‹çŸ¿çŸ³ <b class="highlight">200</b></span>
                    <span>âš¡ èƒ½æº <b class="highlight">100</b></span>
                    <span>ğŸ‘Š ç‚¹å‡»åŠ› <b class="highlight">60</b></span>
                    <span class="country-tag tag-event">ç‹¬æœ‰äº‹ä»¶é“¾</span>
                </div>
            </div>
        </div>
    </div>

    <!-- UIå±‚ -->
    <div class="ui-overlay">
        <!-- é¡¶éƒ¨æ  -->
        <div class="top-bar">
            <div class="civilization-level" id="civLevel">ğŸŒ è¡Œæ˜Ÿæ–‡æ˜</div>
            <div class="resources-compact">
                <div class="resource-compact">
                    <span class="resource-icon-small">ğŸ’</span>
                    <div>
                        <div class="resource-value-small" id="oreVal">0</div>
                        <div class="resource-rate-small" id="oreRate">+0/ç§’</div>
                    </div>
                </div>
                <div class="resource-compact">
                    <span class="resource-icon-small">âš¡</span>
                    <div>
                        <div class="resource-value-small" id="energyVal">0</div>
                        <div class="resource-rate-small" id="energyRate">+0/ç§’</div>
                    </div>
                </div>
                <div class="resource-compact">
                    <span class="resource-icon-small">ğŸ”¬</span>
                    <div>
                        <div class="resource-value-small" id="techVal">0</div>
                        <div class="resource-rate-small" id="techRate">+0/ç§’</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¿›åº¦æ¡ï¼šå›ºå®šåœ¨åº•éƒ¨é¢æ¿æ­£ä¸Šæ–¹ -->
        <div class="top-progress-bar">
            <div style="display:flex;align-items:center;gap:0.8rem;">
                <div id="progressTitle" style="font-family:var(--font-ui);font-size:0.75rem;font-weight:700;color:var(--accent-gold);white-space:nowrap;flex-shrink:0;">ğŸ¯ è·ç¦»åœ°æœˆç³»ç»Ÿ</div>
                <div style="flex:1;height:10px;background:rgba(0,0,0,0.5);border-radius:5px;overflow:hidden;">
                    <div id="progressBar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent-cyan),var(--accent-purple),var(--accent-gold));border-radius:5px;transition:width 0.5s ease;box-shadow:0 0 8px rgba(0,217,255,0.5);"></div>
                </div>
                <div id="progressPercent" style="font-family:var(--font-mono);font-size:0.75rem;color:var(--text-gray);white-space:nowrap;flex-shrink:0;">0%</div>
            </div>
        </div>

        <!-- æç¤ºæ–‡æœ¬å·²ç§»é™¤ï¼Œç”±ç‚¹å‡»åé¦ˆä»£æ›¿ -->

        <!-- åº•éƒ¨é¢æ¿ -->
        <div class="bottom-panel">
            <div class="panel-tabs">
                <button class="tab-button active" data-tab="mining">ğŸ’ è‡ªåŠ¨äº§çº¿</button>
                <button class="tab-button" data-tab="energy">âš¡ è‡ªåŠ¨èƒ½æº</button>
                <button class="tab-button" data-tab="tech">ğŸ”¬ ç§‘æŠ€ç³»ç»Ÿ</button>
                <button class="tab-button" data-tab="special">âœ¨ ç‰¹æ®Š</button>
            </div>

            <div class="tab-content active" id="tab-mining">
                <div class="upgrades-grid" id="miningGrid"></div>
            </div>
            <div class="tab-content" id="tab-energy">
                <div class="upgrades-grid" id="energyGrid"></div>
            </div>
            <div class="tab-content" id="tab-tech">
                <div class="upgrades-grid" id="techGrid"></div>
            </div>
            <div class="tab-content" id="tab-special">
                <div class="upgrades-grid" id="specialGrid"></div>
            </div>
            
            <div class="bottom-actions">
                <a href="https://gameart.top" class="home-btn" target="_blank">ğŸ  é¦–é¡µ</a>
                <button class="reset-btn" onclick="resetGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
                <button class="home-btn" onclick="testTechLevel()" style="background: rgba(147, 112, 219, 0.15); border-color: rgba(147, 112, 219, 0.4); color: #9370db;">ğŸ§ª æµ‹è¯•ç§‘æŠ€ç­‰çº§</button>
            </div>
        </div>
    </div>

    <script src="scene.js"></script>
    <script>
        // æ¸¸æˆçŠ¶æ€
        const game = {
            ore: 0,           // çŸ¿çŸ³ï¼ˆåŸºç¡€èµ„æºï¼Œç‚¹å‡»å’Œå·¥å‚äº§å‡ºï¼‰
            energy: 0,        // èƒ½æºï¼ˆç”¨çŸ¿çŸ³ç”Ÿäº§ï¼‰
            tech: 0,          // ç§‘æŠ€ç‚¹ï¼ˆç”¨èƒ½æºé©±åŠ¨ï¼‰
            techLevel: 0,     // ç§‘æŠ€ç­‰çº§ 0-4
            clickPower: 100,  // ç‚¹å‡»è·å¾—çŸ¿çŸ³
            orePerSec: 0,     // çŸ¿çŸ³äº§é‡
            energyPerSec: 0,  // èƒ½æºäº§é‡
            techPerSec: 0,    // ç§‘æŠ€äº§é‡
            totalEarned: 0,
            totalClicks: 0,
            currentStage: 0,
            lastSaveTime: Date.now(),
            unlockedPlanets: ['earth'],
            upgrades: { mining: [], energy: [], tech: [], special: [] }
        };
        window.game = game;  // ä¾› scene.js è®¿é—®

        // æ–‡æ˜é˜¶æ®µ
        const stages = [
            { id: 0, name: 'ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', desc: 'äººç±»æ–‡æ˜çš„èµ·ç‚¹', threshold: 0, nextThreshold: 200, view: 'earth' },
            { id: 1, name: 'ğŸŒ™ åœ°æœˆç³»ç»Ÿ', desc: 'æœˆçƒæˆä¸ºäººç±»ç¬¬äºŒå®¶å›­', threshold: 200, nextThreshold: 1000, view: 'inner' },
            { id: 2, name: 'ğŸª å†…è¡Œæ˜Ÿå¾æœ', desc: 'æ°´æ˜Ÿã€é‡‘æ˜Ÿã€ç«æ˜Ÿæ®–æ°‘å®Œæˆ', threshold: 1000, nextThreshold: 5000, view: 'inner' },
            { id: 3, name: 'â˜€ï¸ å¤ªé˜³ç³»éœ¸ä¸»', desc: 'æŒæ§å…«å¤§è¡Œæ˜Ÿ', threshold: 5000, nextThreshold: 25000, view: 'solar' },
            { id: 4, name: 'ğŸŒŒ é“¶æ²³æ¢ç´¢è€…', desc: 'æ˜Ÿé™…æ—¶ä»£æ¥ä¸´', threshold: 25000, nextThreshold: Infinity, view: 'galaxy' }
        ];

        // è¡Œæ˜Ÿæ•°æ®
        // è¡Œæ˜Ÿæ•°æ®ï¼ˆè·ç¦»/è§’åº¦å†³å®šå¸ƒå±€ï¼ŒcssClasså¯¹åº”çœŸå®å›¾ç‰‡ï¼‰
        const planets = [
            { id: 'sun',     name: 'å¤ªé˜³',   radius: 44, color: '#FDB813', unlockStage: 0, isSun: true,  cssClass: 'p-sun',     clickMulti: 0  },
            { id: 'mercury', name: 'æ°´æ˜Ÿ',   distance: 105, angle: 15,  radius: 9,  color: '#8C7853', unlockStage: 2, cssClass: 'p-mercury', clickMulti: 2  },
            { id: 'venus',   name: 'é‡‘æ˜Ÿ',   distance: 148, angle: 55,  radius: 13, color: '#E8C07D', unlockStage: 2, cssClass: 'p-venus',   clickMulti: 3  },
            { id: 'earth',   name: 'åœ°çƒ',   distance: 192, angle: 100, radius: 16, color: '#4A90E2', unlockStage: 0, cssClass: 'p-earth',   clickMulti: 1  },
            { id: 'moon',    name: 'æœˆçƒ',   distance: 222, angle: 113, radius: 9,  color: '#CCCCCC', unlockStage: 1, cssClass: 'p-moon',    clickMulti: 2  },
            { id: 'mars',    name: 'ç«æ˜Ÿ',   distance: 252, angle: 148, radius: 12, color: '#D94A2E', unlockStage: 2, cssClass: 'p-mars',    clickMulti: 4  },
            { id: 'jupiter', name: 'æœ¨æ˜Ÿ',   distance: 328, angle: 195, radius: 30, color: '#C88B3A', unlockStage: 3, cssClass: 'p-jupiter', clickMulti: 8  },
            { id: 'saturn',  name: 'åœŸæ˜Ÿ',   distance: 385, angle: 238, radius: 25, color: '#FAD5A5', unlockStage: 3, cssClass: 'p-saturn',  clickMulti: 10 },
            { id: 'uranus',  name: 'å¤©ç‹æ˜Ÿ', distance: 430, angle: 278, radius: 19, color: '#4FD5D6', unlockStage: 3, cssClass: 'p-uranus',  clickMulti: 12 },
            { id: 'neptune', name: 'æµ·ç‹æ˜Ÿ', distance: 468, angle: 320, radius: 17, color: '#4166F5', unlockStage: 3, cssClass: 'p-neptune', clickMulti: 15 }
        ];
        window.planets = planets;  // ä¾› scene.js è®¿é—®

        // å‡çº§é…ç½® - æ–°çš„èµ„æºé“¾æ¡ï¼šçŸ¿çŸ³â†’èƒ½æºâ†’ç§‘æŠ€
        const upgradesConfig = {
            // é‡‡çŸ¿è®¾æ–½ï¼šäº§å‡ºçŸ¿çŸ³ï¼ˆå…è´¹ï¼Œè‡ªåŠ¨äº§å‡ºï¼‰
            mining: [
                { id: 'm1', name: 'åŸºç¡€å·¥å‚', icon: 'ğŸ­', baseProduction: 2, baseCost: 50, costMult: 1.12, costType: 'ore', outputType: 'ore' },
                { id: 'm2', name: 'è‡ªåŠ¨äº§çº¿', icon: 'ğŸ¤–', baseProduction: 10, baseCost: 300, costMult: 1.12, costType: 'ore', outputType: 'ore' },
                { id: 'm3', name: 'çº³ç±³å·¥å‚', icon: 'âš™ï¸', baseProduction: 50, baseCost: 1500, costMult: 1.12, costType: 'ore', outputType: 'ore' },
                { id: 'm4', name: 'é‡å­å·¥å‚', icon: 'âš›ï¸', baseProduction: 250, baseCost: 8000, costMult: 1.12, costType: 'ore', outputType: 'ore' }
            ],
            // èƒ½æºè®¾æ–½ï¼šæ¶ˆè€—çŸ¿çŸ³ï¼Œäº§å‡ºèƒ½æº
            energy: [
                { id: 'e1', name: 'æ ¸ç”µç«™', icon: 'â˜¢ï¸', baseProduction: 3, baseCost: 100, costMult: 1.14, costType: 'ore', outputType: 'energy' },
                { id: 'e2', name: 'æ ¸èšå˜å †', icon: 'âš¡', baseProduction: 18, baseCost: 800, costMult: 1.14, costType: 'ore', outputType: 'energy' },
                { id: 'e3', name: 'å«æ˜Ÿå¤ªé˜³èƒ½', icon: 'ğŸ›°ï¸', baseProduction: 120, baseCost: 5000, costMult: 1.14, costType: 'ore', outputType: 'energy' },
                { id: 'e4', name: 'åç‰©è´¨å¼•æ“', icon: 'âœ¨', baseProduction: 800, baseCost: 30000, costMult: 1.14, costType: 'ore', outputType: 'energy' }
            ],
            // ç§‘æŠ€ç³»ç»Ÿï¼šæ¶ˆè€—èƒ½æºï¼Œè§£é”ç§‘æŠ€ç­‰çº§ï¼ˆæ¯ä¸ªåªèƒ½è´­ä¹°ä¸€æ¬¡ï¼‰
            tech: [
                { id: 't1', name: 'åœ°æœˆå¼•åŠ›æ¡¥', icon: 'ğŸŒ™', techLevel: 1, baseCost: 5000, desc: 'è¿æ¥åœ°çƒä¸æœˆçƒï¼Œå¼€å¯æ–‡æ˜æ–°çºªå…ƒ', costType: 'energy', unlocked: false },
                { id: 't2', name: 'å¤ªé˜³ç³»å¼•åŠ›æ¡¥', icon: 'â˜€ï¸', techLevel: 2, baseCost: 3000, desc: 'æŒæ§å¤ªé˜³ç³»å†…è¡Œæ˜Ÿï¼Œæ–‡æ˜è·¨è¶Šå¼å‘å±•', costType: 'energy', unlocked: false },
                { id: 't3', name: 'æ˜Ÿé™…å¼•åŠ›æ¡¥', icon: 'ğŸŒ ', techLevel: 3, baseCost: 20000, desc: 'ç©¿è¶Šæ’æ˜Ÿç³»é—´çš„è™šç©ºï¼Œå¼€åˆ›æ˜Ÿé™…æ–‡æ˜æ–°çºªå…ƒ', costType: 'energy', unlocked: false },
                { id: 't4', name: 'é“¶æ²³ç³»å¼•åŠ›æ¡¥', icon: 'ğŸŒŒ', techLevel: 4, baseCost: 150000, desc: 'é“¶æ²³æ–‡æ˜å·…å³°ï¼Œå¾æœæ˜Ÿè¾°å¤§æµ·', costType: 'energy', unlocked: false }
            ],
            special: [
                { id: 'sp1', name: 'å¤ªç©ºç”µæ¢¯', icon: 'ğŸš¡', baseProduction: 50, baseCost: 500, costMult: 1.15, costType: 'ore', bonus: 'click' },
                { id: 'sp2', name: 'æˆ´æ£®çƒ', icon: 'ğŸŒŸ', baseProduction: 0, baseCost: 10000, costMult: 1.18, costType: 'ore', bonus: 'energyBoost', boostValue: 2.0 },
                { id: 'sp3', name: 'æ—¶ç©ºåŠ é€Ÿå™¨', icon: 'â°', baseProduction: 0, baseCost: 50000, costMult: 1.2, costType: 'energy', bonus: 'speed', speedMult: 1.5 }
            ]
        };

        // æ•°å­—æ ¼å¼åŒ–
        function formatNumber(num) {
            if (num < 1000) return Math.floor(num);
            if (num < 1000000) return (num / 1000).toFixed(1) + 'K';
            if (num < 1000000000) return (num / 1000000).toFixed(2) + 'M';
            return (num / 1000000000).toFixed(2) + 'B';
        }

        // åˆå§‹åŒ–å‡çº§
        function initUpgrades() {
            for (let category in upgradesConfig) {
                upgradesConfig[category].forEach(config => {
                    const item = { ...config, level: 0 };
                    if (category === 'tech') {
                        item.unlocked = false;  // ç§‘æŠ€éœ€è¦è§£é”
                    }
                    game.upgrades[category].push(item);
                });
            }
        }

        // æ¸²æŸ“å‡çº§
        function renderUpgrades() {
            for (let category in game.upgrades) {
                const container = document.getElementById(category + 'Grid');
                if (!container) continue;
                container.innerHTML = '';

                game.upgrades[category].forEach((upgrade, index) => {
                    // ç§‘æŠ€ç³»ç»Ÿç‰¹æ®Šå¤„ç†
                    if (category === 'tech') {
                        const canAfford = game.energy >= upgrade.baseCost;
                        const isLocked = index > 0 && !game.upgrades.tech[index - 1].unlocked;
                        const alreadyUnlocked = upgrade.unlocked;

                        const card = document.createElement('div');
                        card.className = `upgrade-card ${alreadyUnlocked ? 'disabled' : canAfford && !isLocked ? '' : 'disabled'}`;
                        card.innerHTML = `
                            <div class="upgrade-card-header">
                                <span class="upgrade-name">${upgrade.icon} ${upgrade.name}</span>
                                <span class="upgrade-level-badge">${alreadyUnlocked ? 'âœ“ å·²è§£é”' : isLocked ? 'ğŸ”’ é”å®š' : 'æœªè§£é”'}</span>
                            </div>
                            <div style="font-size:0.75rem;color:#94a3b8;margin:0.5rem 0;line-height:1.4;">${upgrade.desc}</div>
                            <div class="upgrade-stats">
                                <span class="upgrade-cost-label">âš¡ ${formatNumber(upgrade.baseCost)} èƒ½æº</span>
                                <span style="color:#a855f7;font-size:0.75rem;">Lv.${upgrade.techLevel}</span>
                            </div>
                            ${isLocked ? '<div style="font-size:0.7rem;color:#f59e0b;margin-top:0.3rem;">éœ€è¦å‰ç½®ç§‘æŠ€</div>' : ''}
                        `;

                        if (!alreadyUnlocked && !isLocked) {
                            card.onclick = () => buyTech(upgrade);
                        }
                        container.appendChild(card);
                    } else {
                        // æ™®é€šå‡çº§
                        const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMult || 1.12, upgrade.level));
                        const costType = upgrade.costType || 'ore';
                        const canAfford = costType === 'ore' ? game.ore >= cost : game.energy >= cost;
                        const production = upgrade.baseProduction * upgrade.level;

                        let costIcon = costType === 'ore' ? 'ğŸ’' : 'âš¡';
                        let costName = costType === 'ore' ? 'çŸ¿çŸ³' : 'èƒ½æº';
                        
                        let prodText = '';
                        if (upgrade.outputType === 'ore') {
                            prodText = production > 0 ? `ğŸ’ +${formatNumber(production)}/ç§’` : '';
                        } else if (upgrade.outputType === 'energy') {
                            prodText = production > 0 ? `âš¡ +${formatNumber(production)}/ç§’` : '';
                        } else if (upgrade.bonus === 'click') {
                            prodText = `ç‚¹å‡» +${upgrade.baseProduction * upgrade.level}`;
                        } else if (upgrade.bonus === 'energyBoost') {
                            prodText = upgrade.level > 0 ? `èƒ½æº Ã—${upgrade.boostValue}` : '';
                        } else if (upgrade.bonus === 'speed') {
                            prodText = upgrade.level > 0 ? `é€Ÿåº¦ Ã—${upgrade.speedMult}` : '';
                        }

                        const card = document.createElement('div');
                        card.className = `upgrade-card ${canAfford ? '' : 'disabled'}`;
                        card.innerHTML = `
                            <div class="upgrade-card-header">
                                <span class="upgrade-name">${upgrade.icon} ${upgrade.name}</span>
                                <span class="upgrade-level-badge">Lv.${upgrade.level}</span>
                            </div>
                            <div class="upgrade-stats">
                                <span class="upgrade-cost-label">${costIcon} ${formatNumber(cost)} ${costName}</span>
                                <span class="upgrade-prod-label">${prodText}</span>
                            </div>
                        `;

                        card.onclick = () => buyUpgrade(upgrade);
                        container.appendChild(card);
                    }
                });
            }
        }

        // è´­ä¹°å‡çº§
        function buyUpgrade(upgrade) {
            const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.costMult || 1.12, upgrade.level));
            const costType = upgrade.costType || 'ore';
            
            const canAfford = costType === 'ore' ? game.ore >= cost : game.energy >= cost;
            
            if (canAfford) {
                if (costType === 'ore') {
                    game.ore -= cost;
                } else {
                    game.energy -= cost;
                }
                
                upgrade.level++;
                
                if (upgrade.bonus === 'click') {
                    game.clickPower += upgrade.baseProduction;
                }

                updateProduction();
                renderUpgrades();
                updateUI();
            }
        }

        // è´­ä¹°ç§‘æŠ€
        function buyTech(tech) {
            if (game.energy >= tech.baseCost && !tech.unlocked) {
                game.energy -= tech.baseCost;
                tech.unlocked = true;
                game.techLevel = tech.techLevel;
                
                // æ›´æ–°æ–‡æ˜ç­‰çº§æ˜¾ç¤º
                const techNames = ['ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', 'ğŸŒ™ åœ°æœˆæ–‡æ˜', 'â˜€ï¸ å¤ªé˜³ç³»æ–‡æ˜', 'ğŸŒ  æ˜Ÿé™…æ–‡æ˜', 'ğŸŒŒ é“¶æ²³æ–‡æ˜'];
                document.getElementById('civLevel').textContent = techNames[game.techLevel];
                
                // é‡ç½®ç”¨æˆ·ç¼©æ”¾ï¼Œå¹³æ»‘è¿‡æ¸¡åˆ°æ–°æ¨èè§†è§’
                applyUserZoom();
                
                // æ›´æ–°å¤ªé˜³ç³»èƒŒæ™¯å±‚è§†è§‰æ•ˆæœ
                updateSolarOverlay();
                
                // æ˜¾ç¤ºé€šçŸ¥
                showTechUnlocked(tech);
                
                updateProduction();
                renderUpgrades();
                updateUI();
            }
        }
        
        // æ˜¾ç¤ºç§‘æŠ€è§£é”é€šçŸ¥
        function showTechUnlocked(tech) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(15, 23, 42, 0.98);
                padding: 2rem 2.5rem;
                border-radius: 20px;
                border: 2px solid var(--accent-cyan);
                max-width: 500px;
                z-index: 9999;
                backdrop-filter: blur(15px);
                box-shadow: 0 0 60px rgba(0, 217, 255, 0.4);
                text-align: center;
            `;
            modal.innerHTML = `
                <div style="font-family: var(--font-ui); font-size: 1.8rem; font-weight: 700; color: var(--accent-cyan); margin-bottom: 1rem;">
                    ${tech.icon} ${tech.name}
                </div>
                <div style="color: #cbd5e1; margin-bottom: 1.5rem; line-height: 1.6;">
                    ${tech.desc}
                </div>
                <button onclick="this.parentElement.remove()" style="
                    width: 100%;
                    background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
                    border: none;
                    padding: 0.8rem;
                    border-radius: 10px;
                    color: white;
                    font-size: 1rem;
                    font-weight: 700;
                    cursor: pointer;
                    font-family: var(--font-ui);
                ">ç»§ç»­æ¢ç´¢ â†’</button>
            `;
            document.body.appendChild(modal);
        }

        // æ›´æ–°äº§é‡
        function updateProduction() {
            game.orePerSec = 0;
            game.energyPerSec = 0;
            game.techPerSec = 0;

            // 1. è®¡ç®—çŸ¿çŸ³äº§é‡ï¼ˆé‡‡çŸ¿å·¥å‚ï¼‰
            game.upgrades.mining.forEach(upgrade => {
                if (upgrade.outputType === 'ore') {
                    game.orePerSec += upgrade.baseProduction * upgrade.level;
                }
            });

            // 2. è®¡ç®—èƒ½æºäº§é‡ï¼ˆèƒ½æºè®¾æ–½ï¼‰
            game.upgrades.energy.forEach(upgrade => {
                if (upgrade.outputType === 'energy') {
                    game.energyPerSec += upgrade.baseProduction * upgrade.level;
                }
            });

            // 3. ç§‘æŠ€äº§é‡ï¼ˆåŸºäºèƒ½æºå’Œç§‘æŠ€ç­‰çº§ï¼‰
            game.techPerSec = game.energyPerSec * 0.01 * (1 + game.techLevel * 0.5);

            // 4. ç‰¹æ®Šå»ºç­‘åŠ æˆ
            const dysonLevel = game.upgrades.special.find(u => u.id === 'sp2')?.level || 0;
            if (dysonLevel > 0) {
                const boost = game.upgrades.special.find(u => u.id === 'sp2')?.boostValue || 1;
                game.energyPerSec *= boost;
            }

            const acceleratorLevel = game.upgrades.special.find(u => u.id === 'sp3')?.level || 0;
            if (acceleratorLevel > 0) {
                const speedMult = game.upgrades.special.find(u => u.id === 'sp3')?.speedMult || 1;
                game.orePerSec *= speedMult;
                game.energyPerSec *= speedMult;
                game.techPerSec *= speedMult;
            }
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('oreVal').textContent = formatNumber(game.ore);
            document.getElementById('energyVal').textContent = formatNumber(game.energy);
            document.getElementById('techVal').textContent = formatNumber(game.tech);
            document.getElementById('oreRate').textContent = '+' + formatNumber(game.orePerSec) + '/ç§’';
            document.getElementById('energyRate').textContent = '+' + formatNumber(game.energyPerSec) + '/ç§’';
            document.getElementById('techRate').textContent = '+' + formatNumber(game.techPerSec) + '/ç§’';
        }

        // æ£€æŸ¥é˜¶æ®µè¿›åº¦
        function checkStageProgress() {
            const currentStage = stages[game.currentStage];
            const nextStage = stages[game.currentStage + 1];

            if (nextStage && game.totalEarned >= nextStage.threshold) {
                advanceStage(nextStage);
            }

            if (nextStage) {
                const progress = ((game.totalEarned - currentStage.threshold) / 
                                 (nextStage.threshold - currentStage.threshold)) * 100;
                
                document.getElementById('progressBar').style.width = Math.min(progress, 100) + '%';
                document.getElementById('progressPercent').textContent = 
                    `${Math.floor(Math.min(progress, 100))}% (${formatNumber(game.totalEarned)} / ${formatNumber(nextStage.threshold)})`;
                document.getElementById('progressTitle').textContent = 'ğŸ¯ è·ç¦»' + nextStage.name;
            } else {
                document.getElementById('progressBar').style.width = '100%';
                document.getElementById('progressPercent').textContent = '100% - æ–‡æ˜å·…å³°';
                document.getElementById('progressTitle').textContent = 'ğŸ‰ æ–‡æ˜å·…å³°';
            }
        }

        // æ¨è¿›é˜¶æ®µ
        function advanceStage(stage) {
            game.currentStage = stage.id;
            document.getElementById('civLevel').textContent = stage.name;

            // è§£é”è¡Œæ˜Ÿ
            planets.forEach(planet => {
                if (planet.unlockStage === stage.id && planet.id !== 'sun') {
                    game.unlockedPlanets.push(planet.id);
                }
            });

            showMilestone(stage);
        }

        // æ˜¾ç¤ºé‡Œç¨‹ç¢‘
        function showMilestone(stage) {
            const modal = document.createElement('div');
            modal.className = 'milestone-overlay';
            modal.innerHTML = `
                <div class="milestone-box">
                    <div class="milestone-emoji">ğŸ‰</div>
                    <div class="milestone-heading">${stage.name}</div>
                    <div class="milestone-description">${stage.desc}</div>
                    <button class="milestone-cta">ç»§ç»­æ¢ç´¢å®‡å®™</button>
                </div>
            `;

            document.body.appendChild(modal);
            modal.querySelector('button').onclick = () => modal.remove();
        }

        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
            });
        });

        // æ¸¸æˆå¾ªç¯
        setInterval(() => {
            game.ore += game.orePerSec / 5;
            game.energy += game.energyPerSec / 5;
            game.tech += game.techPerSec / 5;
            game.totalEarned += game.orePerSec / 5;
            
            updateUI();
            checkStageProgress();
        }, 200);

        // æ¸²æŸ“å¾ªç¯ - é™åˆ¶å¸§ç‡åˆ°30FPSä»¥é™ä½CPUå ç”¨
        let lastFrameTime = 0;
        function gameLoop(timestamp) {
            // é™åˆ¶åˆ°30FPS (çº¦33msä¸€å¸§)
            if (timestamp - lastFrameTime >= 33) {
                drawSolarSystem();
                lastFrameTime = timestamp;
            }
            requestAnimationFrame(gameLoop);
        }

        // è‡ªåŠ¨ä¿å­˜ï¼ˆåªåœ¨é€‰æ‹©å›½å®¶åæ‰ä¿å­˜ï¼‰
        setInterval(() => {
            if (game.country) {  // åªæœ‰é€‰æ‹©äº†å›½å®¶æ‰ä¿å­˜
                game.lastSaveTime = Date.now();
                localStorage.setItem('spaceEmpireV5', JSON.stringify(game));
            }
        }, 5000);

        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saved = localStorage.getItem('spaceEmpireV5');
            if (!saved) return false;

            const savedGame = JSON.parse(saved);
            Object.assign(game, savedGame);

            const offlineTime = (Date.now() - game.lastSaveTime) / 1000;
            if (offlineTime > 60) {
                const offlineOre = game.orePerSec * Math.min(offlineTime, 3600 * 4);
                const offlineEnergy = game.energyPerSec * Math.min(offlineTime, 3600 * 4);
                const offlineTech = game.techPerSec * Math.min(offlineTime, 3600 * 4);
                
                showOfflineEarnings(offlineOre, offlineEnergy, offlineTech, offlineTime);
                game.ore += offlineOre;
                game.energy += offlineEnergy;
                game.tech += offlineTech;
            }

            const techNames = ['ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', 'ğŸŒ™ åœ°æœˆæ–‡æ˜', 'â˜€ï¸ å¤ªé˜³ç³»æ–‡æ˜', 'ğŸŒ  æ˜Ÿé™…æ–‡æ˜', 'ğŸŒŒ é“¶æ²³æ–‡æ˜'];
            document.getElementById('civLevel').textContent = techNames[game.techLevel] || techNames[0];
            updateSolarOverlay();  // æ¢å¤å¤ªé˜³ç³»èƒŒæ™¯å±‚çŠ¶æ€
            updateProduction();
            return true;
        }

        function showOfflineEarnings(ore, energy, tech, time) {
            const hours = Math.floor(time / 3600);
            const minutes = Math.floor((time % 3600) / 60);

            const modal = document.createElement('div');
            modal.className = 'offline-modal';
            modal.innerHTML = `
                <div class="offline-box">
                    <div class="offline-title">æ¬¢è¿å›æ¥ï¼</div>
                    <div>ç¦»çº¿æ—¶é—´: ${hours}å°æ—¶ ${minutes}åˆ†é’Ÿ</div>
                    <div class="offline-amount">ğŸ’ +${formatNumber(ore)}</div>
                    <div class="offline-amount" style="font-size:2rem;margin:0.5rem 0;">âš¡ +${formatNumber(energy)}</div>
                    <div class="offline-amount" style="font-size:1.5rem;margin:0.5rem 0;">ğŸ”¬ +${formatNumber(tech)}</div>
                    <div style="margin-bottom: 1.5rem;">èµ„æºå·²è‡ªåŠ¨æ”¶é›†</div>
                    <button class="offline-btn">å¤ªæ£’äº†ï¼</button>
                </div>
            `;

            document.body.appendChild(modal);
            modal.querySelector('button').onclick = () => {
                modal.remove();
                updateUI();
            };
        }

        // ===== å›½å®¶é…ç½® =====
        const countryConfigs = {
            usa:     { name: 'ç¾å›½',   flag: 'ğŸ‡ºğŸ‡¸', ore: 400,  energy: 50,  clickPower: 60  },
            china:   { name: 'ä¸­å›½',   flag: 'ğŸ‡¨ğŸ‡³', ore: 200,  energy: 80,  clickPower: 80  },
            russia:  { name: 'ä¿„ç½—æ–¯', flag: 'ğŸ‡·ğŸ‡º', ore: 500,  energy: 60,  clickPower: 60  },
            germany: { name: 'å¾·å›½',   flag: 'ğŸ‡©ğŸ‡ª', ore: 250,  energy: 70,  clickPower: 60  },
            japan:   { name: 'æ—¥æœ¬',   flag: 'ğŸ‡¯ğŸ‡µ', ore: 150,  energy: 100, clickPower: 60  }
        };

        function selectCountry(id) {
            const cfg = countryConfigs[id];
            game.ore = cfg.ore;
            game.energy = cfg.energy;
            game.totalEarned = 0;  // åˆå§‹ç¤¼åŒ…ä¸è®¡å…¥æ€»æ”¶ç›Šï¼Œé¿å…ç«‹åˆ»è§¦å‘é˜¶æ®µæ¨è¿›
            game.clickPower = cfg.clickPower;
            game.country = id;
            game.countryName = cfg.name;

            // æ‰€æœ‰å›½å®¶é»˜è®¤èµ é€1çº§åŸºç¡€å·¥å‚
            const basicFactory = game.upgrades.mining.find(u => u.id === 'm1');
            if (basicFactory) {
                basicFactory.level = 1;
            }

            // æ·¡å‡ºé€‰å›½ç•Œé¢ï¼Œæ·¡å…¥æ¸¸æˆ
            const screen = document.getElementById('countryScreen');
            screen.style.transition = 'opacity 0.8s ease';
            screen.style.opacity = '0';
            setTimeout(() => screen.remove(), 800);

            updateUI();
            checkStageProgress();
        }

        function resetGame() {
            if (!confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¼šä¸¢å¤±ï¼')) {
                return;
            }
            // è®¾ç½®é‡ç½®æ ‡å¿—ï¼Œç„¶åæ¸…é™¤å­˜æ¡£
            sessionStorage.setItem('resetFlag', 'true');
            localStorage.removeItem('spaceEmpireV5');
            location.reload(true);  // å¼ºåˆ¶ä»æœåŠ¡å™¨é‡æ–°åŠ è½½
        }

        // æµ‹è¯•ç§‘æŠ€ç­‰çº§ï¼ˆå¾ªç¯åˆ‡æ¢Lv0-4ï¼‰
        function testTechLevel() {
            game.techLevel = (game.techLevel + 1) % 5;
            
            // æ›´æ–°æ˜¾ç¤º
            const techNames = ['ğŸŒ è¡Œæ˜Ÿæ–‡æ˜', 'ğŸŒ™ åœ°æœˆæ–‡æ˜', 'â˜€ï¸ å¤ªé˜³ç³»æ–‡æ˜', 'ğŸŒ  æ˜Ÿé™…æ–‡æ˜', 'ğŸŒŒ é“¶æ²³æ–‡æ˜'];
            document.getElementById('civLevel').textContent = techNames[game.techLevel];
            
            // é‡ç½®ç”¨æˆ·ç¼©æ”¾åˆ°æ¨èè§†è§’
            applyUserZoom();
            
            // æ›´æ–°èƒŒæ™¯å±‚
            updateSolarOverlay();
            
            // è§£é”æ‰€æœ‰æ˜Ÿçƒä»¥ä¾¿è§‚å¯Ÿå…‰è·¯æ•ˆæœ
            game.unlockedPlanets = planets.map(p => p.id);
            
            // æ˜¾ç¤ºæç¤º
            const tip = document.createElement('div');
            tip.style.cssText = `
                position: fixed; top: 50%; left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.9);
                color: #fff;
                padding: 2rem 3rem;
                border-radius: 15px;
                border: 2px solid ${['#fbbf24', '#00d9ff', '#a855f7', '#ff00ff', '#ffffff'][game.techLevel]};
                font-size: 1.5rem;
                font-weight: 700;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
                text-align: center;
            `;
            tip.innerHTML = `
                ${techNames[game.techLevel]}<br>
                <span style="font-size:1rem; opacity:0.8; display:block; margin-top:0.5rem;">
                    è§‚å¯Ÿå…‰è·¯é¢œè‰²ã€ç½‘ç»œå¤æ‚åº¦å’ŒèƒŒæ™¯æ˜Ÿäº‘å˜åŒ–
                </span>
            `;
            document.body.appendChild(tip);
            setTimeout(() => {
                tip.style.transition = 'opacity 0.5s';
                tip.style.opacity = '0';
                setTimeout(() => tip.remove(), 500);
            }, 2000);
        }

        // é¢œè‰²å·¥å…·å‡½æ•°
        function lightenColor(hex, amount) {
            const num = parseInt(hex.replace('#',''), 16);
            const r = Math.min(255, (num >> 16) + amount);
            const g = Math.min(255, ((num >> 8) & 0xFF) + amount);
            const b = Math.min(255, (num & 0xFF) + amount);
            return `rgb(${r},${g},${b})`;
        }
        function darkenColor(hex, amount) {
            const num = parseInt(hex.replace('#',''), 16);
            const r = Math.max(0, (num >> 16) - amount);
            const g = Math.max(0, ((num >> 8) & 0xFF) - amount);
            const b = Math.max(0, (num & 0xFF) - amount);
            return `rgb(${r},${g},${b})`;
        }

        // é¼ æ ‡æ»šè½®ç¼©æ”¾ / è§¦æ‘¸æåˆç¼©æ”¾ â†’ ç”± scene.js ç»Ÿä¸€å¤„ç†
        
        // åˆå§‹åŒ–
        window.addEventListener('resize', () => { resizeCanvas(); });
        resizeCanvas();
        // initStarfield() å·²ç§»é™¤ï¼Œæ”¹ç”¨ STARS æ•°ç»„ï¼ˆsolar-scale æ–¹å¼ï¼‰
        initPlanetDivs();   // åˆ›å»ºCSSè¡Œæ˜Ÿdiv
        initUpgrades();
        updateSolarOverlay();  // åˆå§‹åŒ–å¤ªé˜³ç³»æ˜¾ç¤ºï¼ˆåŒæ—¶è§¦å‘åœºæ™¯è¿‡æ¸¡ï¼‰

        // æ£€æŸ¥æ˜¯å¦æ˜¯é‡ç½®æ“ä½œ
        const isReset = sessionStorage.getItem('resetFlag');
        if (isReset) {
            sessionStorage.removeItem('resetFlag');
            // é‡ç½®æ—¶ç¡®ä¿é€‰å›½ç•Œé¢æ˜¾ç¤º
            const countryScreen = document.getElementById('countryScreen');
            if (countryScreen) {
                countryScreen.style.display = 'flex';
                countryScreen.style.opacity = '1';
            }
        } else {
            // æ­£å¸¸åŠ è½½ï¼šæœ‰å­˜æ¡£ç›´æ¥è¿›æ¸¸æˆï¼Œæ²¡æœ‰å­˜æ¡£æ˜¾ç¤ºé€‰å›½ç•Œé¢
            const hasSave = loadGame();
            if (hasSave) {
                const countryScreen = document.getElementById('countryScreen');
                if (countryScreen) {
                    countryScreen.remove();
                }
            }
        }

        renderUpgrades();
        updateUI();
        checkStageProgress();
        gameLoop();

        window.addEventListener('beforeunload', () => {
            if (game.country) {  // åªæœ‰é€‰æ‹©äº†å›½å®¶æ‰ä¿å­˜
                localStorage.setItem('spaceEmpireV5', JSON.stringify(game));
            }
        });
    </script>
</body>
</html>
